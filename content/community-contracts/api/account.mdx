---
title: "Account"
description: "Smart contract account utilities and implementations"
---

This directory includes contracts to build accounts for ERC-4337. These include:

* [`ERC7579Executor`](#ERC7579Executor): An executor module that enables executing calls from accounts where the it’s installed.
* [`ERC7579DelayedExecutor`](#ERC7579DelayedExecutor): An executor module that adds a delay before executing an account operation.
* [`ERC7579SelectorExecutor`](#ERC7579SelectorExecutor): An executor module that restricts execution to specific function selectors.
* [`ERC7579Validator`](#ERC7579Validator): Abstract validator module for ERC-7579 accounts that provides base implementation for signature validation.
* [`ERC7579Signature`](#ERC7579Signature): Implementation of [`ERC7579Validator`](#ERC7579Validator) using ERC-7913 signature verification for address-less cryptographic keys and account signatures.
* [`ERC7579Multisig`](#ERC7579Multisig): An extension of [`ERC7579Validator`](#ERC7579Validator) that enables validation using ERC-7913 signer keys.
* [`ERC7579MultisigWeighted`](#ERC7579MultisigWeighted): An extension of [`ERC7579Multisig`](#ERC7579Multisig) that allows different weights to be assigned to signers.
* [`ERC7579MultisigConfirmation`](#ERC7579MultisigConfirmation): An extension of [`ERC7579Multisig`](#ERC7579Multisig) that requires each signer to provide a confirmation signature.
* [`ERC7579MultisigStorage`](#ERC7579MultisigStorage): An extension of [`ERC7579Multisig`](#ERC7579Multisig) that allows storing presigned approvals in storage.
* [`PaymasterCore`](#PaymasterCore): An ERC-4337 paymaster implementation that includes the core logic to validate and pay for user operations.
* [`PaymasterERC20`](#PaymasterERC20): A paymaster that allows users to pay for user operations using ERC-20 tokens.
* [`PaymasterERC20Guarantor`](#PaymasterERC20Guarantor): A paymaster that enables third parties to guarantee user operations by pre-funding gas costs, with the option for users to repay or for guarantors to absorb the cost.
* [`PaymasterERC721Owner`](#PaymasterERC721Owner): A paymaster that allows users to pay for user operations based on ERC-721 ownership.
* [`PaymasterSigner`](#PaymasterSigner): A paymaster that allows users to pay for user operations using an authorized signature.

## Modules

### Executors

[`ERC7579Executor`](#ERC7579Executor)

[`ERC7579DelayedExecutor`](#ERC7579DelayedExecutor)

[`ERC7579SelectorExecutor`](#ERC7579SelectorExecutor)

### Validators

[`ERC7579Validator`](#ERC7579Validator)

[`ERC7579Signature`](#ERC7579Signature)

[`ERC7579Multisig`](#ERC7579Multisig)

[`ERC7579MultisigWeighted`](#ERC7579MultisigWeighted)

[`ERC7579MultisigConfirmation`](#ERC7579MultisigConfirmation)

[`ERC7579MultisigStorage`](#ERC7579MultisigStorage)

## Paymaster

[`PaymasterCore`](#PaymasterCore)

[`PaymasterERC20`](#PaymasterERC20)

[`PaymasterERC20Guarantor`](#PaymasterERC20Guarantor)

[`PaymasterERC721Owner`](#PaymasterERC721Owner)

[`PaymasterSigner`](#PaymasterSigner)

<a id="ERC7579DelayedExecutor"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579DelayedExecutor`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579DelayedExecutor.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579DelayedExecutor.sol";
```

Extension of [`ERC7579Executor`](#ERC7579Executor) that allows scheduling and executing delayed operations
with expiration. This module enables time-delayed execution patterns for smart accounts.

==== Operation Lifecycle

1. Scheduling: Operations are scheduled via [`ERC7579DelayedExecutor.schedule`](#ERC7579DelayedExecutor-schedule-address-bytes32-bytes32-bytes-) with a specified delay period.
The delay period is set during [`ERC7579DelayedExecutor.onInstall`](#ERC7579DelayedExecutor-onInstall-bytes-) and can be customized via [`ERC7579DelayedExecutor.setDelay`](#ERC7579DelayedExecutor-setDelay-uint32-). Each
operation enters a `Scheduled` state and must wait for its delay period to elapse.

2. Security Window: During the delay period, operations remain in `Scheduled` state but
cannot be executed. Through this period, suspicious operations can be monitored and
canceled via [`ERC7579DelayedExecutor.cancel`](#ERC7579DelayedExecutor-cancel-address-bytes32-bytes32-bytes-) if appropriate.

3. Execution & Expiration: Once the delay period elapses, operations transition to `Ready` state.
Operations can be executed via [`ERC7579Executor.execute`](#ERC7579Executor-execute-address-bytes32-bytes32-bytes-) and have an expiration period after becoming
executable. If an operation is not executed within the expiration period, it becomes `Expired`
and can't be executed. Expired operations must be rescheduled with a different salt.

==== Delay Management

Accounts can set their own delay periods during installation or via [`ERC7579DelayedExecutor.setDelay`](#ERC7579DelayedExecutor-setDelay-uint32-).
The delay period is enforced even between installas and uninstalls to prevent
immediate downgrades. When setting a new delay period, the new delay takes effect
after a transition period defined by the current delay or [`ERC7579DelayedExecutor.minSetback`](#ERC7579DelayedExecutor-minSetback--), whichever
is longer.

==== Authorization

Authorization for scheduling and canceling operations is controlled through the [`ERC7579DelayedExecutor._validateSchedule`](#ERC7579DelayedExecutor-_validateSchedule-address-bytes32-bytes32-bytes-)
and [`ERC7579DelayedExecutor._validateCancel`](#ERC7579DelayedExecutor-_validateCancel-address-bytes32-bytes32-bytes-) functions. These functions can be overridden to implement custom
authorization logic, such as requiring specific signers or roles.

<Callout>
Use [`ERC7579DelayedExecutor._scheduleAt`](#ERC7579DelayedExecutor-_scheduleAt-address-bytes32-bytes32-bytes-uint48-uint32-) to schedule operations at a specific points in time. This is
useful to pre-schedule operations for non-deployed accounts (e.g. subscriptions).
</Callout>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [state(account, salt, mode, executionCalldata)](#ERC7579DelayedExecutor-state-address-bytes32-bytes32-bytes-)
- [state(operationId)](#ERC7579DelayedExecutor-state-bytes32-)
- [minSetback()](#ERC7579DelayedExecutor-minSetback--)
- [getDelay(account)](#ERC7579DelayedExecutor-getDelay-address-)
- [getExpiration(account)](#ERC7579DelayedExecutor-getExpiration-address-)
- [getSchedule(account, salt, mode, executionCalldata)](#ERC7579DelayedExecutor-getSchedule-address-bytes32-bytes32-bytes-)
- [getSchedule(operationId)](#ERC7579DelayedExecutor-getSchedule-bytes32-)
- [hashOperation(account, salt, mode, executionCalldata)](#ERC7579DelayedExecutor-hashOperation-address-bytes32-bytes32-bytes-)
- [defaultExpiration()](#ERC7579DelayedExecutor-defaultExpiration--)
- [onInstall(initData)](#ERC7579DelayedExecutor-onInstall-bytes-)
- [setDelay(newDelay)](#ERC7579DelayedExecutor-setDelay-uint32-)
- [setExpiration(newExpiration)](#ERC7579DelayedExecutor-setExpiration-uint32-)
- [schedule(account, salt, mode, data)](#ERC7579DelayedExecutor-schedule-address-bytes32-bytes32-bytes-)
- [cancel(account, salt, mode, data)](#ERC7579DelayedExecutor-cancel-address-bytes32-bytes32-bytes-)
- [onUninstall()](#ERC7579DelayedExecutor-onUninstall-bytes-)
- [_validateExecution(, , , data)](#ERC7579DelayedExecutor-_validateExecution-address-bytes32-bytes32-bytes-)
- [_validateCancel(account, , , )](#ERC7579DelayedExecutor-_validateCancel-address-bytes32-bytes32-bytes-)
- [_validateSchedule(account, , , )](#ERC7579DelayedExecutor-_validateSchedule-address-bytes32-bytes32-bytes-)
- [_setDelay(account, newDelay, minimumSetback)](#ERC7579DelayedExecutor-_setDelay-address-uint32-uint32-)
- [_setExpiration(account, newExpiration)](#ERC7579DelayedExecutor-_setExpiration-address-uint32-)
- [_scheduleAt(account, salt, mode, executionCalldata, timepoint, delay)](#ERC7579DelayedExecutor-_scheduleAt-address-bytes32-bytes32-bytes-uint48-uint32-)
- [_execute(account, salt, mode, executionCalldata)](#ERC7579DelayedExecutor-_execute-address-bytes32-bytes32-bytes-)
- [_cancel(account, mode, executionCalldata, salt)](#ERC7579DelayedExecutor-_cancel-address-bytes32-bytes-bytes32-)
- [_validateStateBitmap(operationId, allowedStates)](#ERC7579DelayedExecutor-_validateStateBitmap-bytes32-bytes32-)
- [_encodeStateBitmap(operationState)](#ERC7579DelayedExecutor-_encodeStateBitmap-enum-ERC7579DelayedExecutor-OperationState-)
#### ERC7579Executor [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Executor-isModuleType-uint256-)
- [execute(account, salt, mode, data)](#ERC7579Executor-execute-address-bytes32-bytes32-bytes-)
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7579ExecutorOperationScheduled(account, operationId, salt, mode, executionCalldata, schedule)](#ERC7579DelayedExecutor-ERC7579ExecutorOperationScheduled-address-bytes32-bytes32-bytes32-bytes-uint48-)
- [ERC7579ExecutorOperationCanceled(account, operationId)](#ERC7579DelayedExecutor-ERC7579ExecutorOperationCanceled-address-bytes32-)
- [ERC7579ExecutorDelayUpdated(account, newDelay, effectTime)](#ERC7579DelayedExecutor-ERC7579ExecutorDelayUpdated-address-uint32-uint48-)
- [ERC7579ExecutorExpirationUpdated(account, newExpiration)](#ERC7579DelayedExecutor-ERC7579ExecutorExpirationUpdated-address-uint32-)
#### ERC7579Executor [!toc]
- [ERC7579ExecutorOperationExecuted(account, salt, mode, executionCalldata)](#ERC7579Executor-ERC7579ExecutorOperationExecuted-address-bytes32-bytes32-bytes-)
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [ERC7579ExecutorUnexpectedOperationState(operationId, currentState, allowedStates)](#ERC7579DelayedExecutor-ERC7579ExecutorUnexpectedOperationState-bytes32-enum-ERC7579DelayedExecutor-OperationState-bytes32-)
- [ERC7579ExecutorModuleNotInstalled()](#ERC7579DelayedExecutor-ERC7579ExecutorModuleNotInstalled--)
#### ERC7579Executor [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579DelayedExecutor-state-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">state(address account, bytes32 salt, bytes32 mode, bytes executionCalldata) → enum ERC7579DelayedExecutor.OperationState</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-state-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Current state of an operation.

</div>
</div>

<a id="ERC7579DelayedExecutor-state-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">state(bytes32 operationId) → enum ERC7579DelayedExecutor.OperationState</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-state-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Same as [`ERC7579DelayedExecutor.state`](#ERC7579DelayedExecutor-state-bytes32-), but for a specific operation id.

</div>
</div>

<a id="ERC7579DelayedExecutor-minSetback--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">minSetback() → uint32</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-minSetback--">#</a>
</div>
</div>
<div className="px-4">

Minimum delay after which [`ERC7579DelayedExecutor.setDelay`](#ERC7579DelayedExecutor-setDelay-uint32-) takes effect.
Set as default delay if not provided during [`ERC7579DelayedExecutor.onInstall`](#ERC7579DelayedExecutor-onInstall-bytes-).

</div>
</div>

<a id="ERC7579DelayedExecutor-getDelay-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">getDelay(address account) → uint32 delay, uint32 pendingDelay, uint48 effectTime</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-getDelay-address-">#</a>
</div>
</div>
<div className="px-4">

Delay for a specific account.

</div>
</div>

<a id="ERC7579DelayedExecutor-getExpiration-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">getExpiration(address account) → uint32 expiration</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-getExpiration-address-">#</a>
</div>
</div>
<div className="px-4">

Expiration delay for account operations.

</div>
</div>

<a id="ERC7579DelayedExecutor-getSchedule-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">getSchedule(address account, bytes32 salt, bytes32 mode, bytes executionCalldata) → uint48 scheduledAt, uint48 executableAt, uint48 expiresAt</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-getSchedule-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Schedule for an operation. Returns default values if not set (i.e. `uint48(0)`, `uint48(0)`, `uint48(0)`).

</div>
</div>

<a id="ERC7579DelayedExecutor-getSchedule-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">getSchedule(bytes32 operationId) → uint48 scheduledAt, uint48 executableAt, uint48 expiresAt</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-getSchedule-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Same as [`ERC7579DelayedExecutor.getSchedule`](#ERC7579DelayedExecutor-getSchedule-bytes32-) but with the operation id.

</div>
</div>

<a id="ERC7579DelayedExecutor-hashOperation-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">hashOperation(address account, bytes32 salt, bytes32 mode, bytes executionCalldata) → bytes32</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-hashOperation-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Returns the operation id.

</div>
</div>

<a id="ERC7579DelayedExecutor-defaultExpiration--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">defaultExpiration() → uint32</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-defaultExpiration--">#</a>
</div>
</div>
<div className="px-4">

Default expiration for account operations. Set if not provided during [`ERC7579DelayedExecutor.onInstall`](#ERC7579DelayedExecutor-onInstall-bytes-).

</div>
</div>

<a id="ERC7579DelayedExecutor-onInstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onInstall(bytes initData)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-onInstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Sets up the module's initial configuration when installed by an account.
The account calling this function becomes registered with the module.

The `initData` may be `abi.encode(uint32(initialDelay), uint32(initialExpiration))`.
The delay will be set to the maximum of this value and the minimum delay if provided.
Otherwise, the delay will be set to [`ERC7579DelayedExecutor.minSetback`](#ERC7579DelayedExecutor-minSetback--) and [`ERC7579DelayedExecutor.defaultExpiration`](#ERC7579DelayedExecutor-defaultExpiration--) respectively.

Behaves as a no-op if the module is already installed.

Requirements:

* The account (i.e `msg.sender`) must implement the `IERC7579ModuleConfig` interface.
* `initData` must be empty or decode correctly to `(uint32, uint32)`.

</div>
</div>

<a id="ERC7579DelayedExecutor-setDelay-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">setDelay(uint32 newDelay)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-setDelay-uint32-">#</a>
</div>
</div>
<div className="px-4">

Allows an account to update its execution delay (see [`ERC7579DelayedExecutor.getDelay`](#ERC7579DelayedExecutor-getDelay-address-)).

The new delay will take effect after a transition period defined by the current delay
or [`ERC7579DelayedExecutor.minSetback`](#ERC7579DelayedExecutor-minSetback--), whichever is longer. This prevents immediate security downgrades.
Can only be called by the account itself.

</div>
</div>

<a id="ERC7579DelayedExecutor-setExpiration-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">setExpiration(uint32 newExpiration)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-setExpiration-uint32-">#</a>
</div>
</div>
<div className="px-4">

Allows an account to update its execution expiration (see [`ERC7579DelayedExecutor.getExpiration`](#ERC7579DelayedExecutor-getExpiration-address-)).

</div>
</div>

<a id="ERC7579DelayedExecutor-schedule-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">schedule(address account, bytes32 salt, bytes32 mode, bytes data)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-schedule-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Schedules an operation to be executed after the account's delay period (see [`ERC7579DelayedExecutor.getDelay`](#ERC7579DelayedExecutor-getDelay-address-)).
Operations are uniquely identified by the combination of `salt`, `mode`, and `data`.
See [`ERC7579DelayedExecutor._validateSchedule`](#ERC7579DelayedExecutor-_validateSchedule-address-bytes32-bytes32-bytes-) for authorization checks.

</div>
</div>

<a id="ERC7579DelayedExecutor-cancel-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">cancel(address account, bytes32 salt, bytes32 mode, bytes data)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-cancel-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Cancels a previously scheduled operation. Can only be called by the account that
scheduled the operation. See [`ERC7579DelayedExecutor._cancel`](#ERC7579DelayedExecutor-_cancel-address-bytes32-bytes-bytes32-).

</div>
</div>

<a id="ERC7579DelayedExecutor-onUninstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onUninstall(bytes)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-onUninstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Cleans up the [`ERC7579DelayedExecutor.getDelay`](#ERC7579DelayedExecutor-getDelay-address-) and [`ERC7579DelayedExecutor.getExpiration`](#ERC7579DelayedExecutor-getExpiration-address-) values by scheduling them to `0`
and respecting the previous delay and expiration values.

<Callout type="warn">
This function does not clean up scheduled operations. This means operations
could potentially be re-executed if the module is reinstalled later. This is a deliberate
design choice for efficiency, but module implementations may want to override this behavior
to clear scheduled operations during uninstallation for their specific use cases.
</Callout>

<Callout>
Calling this function directly will remove the expiration ([`ERC7579DelayedExecutor.getExpiration`](#ERC7579DelayedExecutor-getExpiration-address-)) value and
will schedule a reset of the delay ([`ERC7579DelayedExecutor.getDelay`](#ERC7579DelayedExecutor-getDelay-address-)) to `0` for the account. Reinstalling the
module will not immediately reset the delay if the delay reset hasn't taken effect yet.
</Callout>

</div>
</div>

<a id="ERC7579DelayedExecutor-_validateExecution-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateExecution(address, bytes32, bytes32, bytes data) → bytes</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_validateExecution-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Returns `data` as the execution calldata. See [`ERC7579Executor._execute`](#ERC7579Executor-_execute-address-bytes32-bytes32-bytes-).

<Callout>
This function relies on the operation state validation in [`ERC7579DelayedExecutor._execute`](#ERC7579DelayedExecutor-_execute-address-bytes32-bytes32-bytes-) for
authorization. Extensions of this module should override this function to implement
additional validation logic if needed.
</Callout>

</div>
</div>

<a id="ERC7579DelayedExecutor-_validateCancel-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateCancel(address account, bytes32, bytes32, bytes)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_validateCancel-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Validates whether an operation can be canceled.

Example extension:

```solidity
 function _validateCancel(address account, bytes32 salt, bytes32 mode, bytes calldata data) internal override {
   // e.g. require(msg.sender == account);
 }
```

</div>
</div>

<a id="ERC7579DelayedExecutor-_validateSchedule-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateSchedule(address account, bytes32, bytes32, bytes)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_validateSchedule-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Validates whether an operation can be scheduled.

Example extension:

```solidity
 function _validateSchedule(address account, bytes32 salt, bytes32 mode, bytes calldata data) internal override {
   // e.g. require(msg.sender == account);
 }
```

</div>
</div>

<a id="ERC7579DelayedExecutor-_setDelay-address-uint32-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_setDelay(address account, uint32 newDelay, uint32 minimumSetback)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_setDelay-address-uint32-uint32-">#</a>
</div>
</div>
<div className="px-4">

Internal implementation for setting an account's delay. See [`ERC7579DelayedExecutor.getDelay`](#ERC7579DelayedExecutor-getDelay-address-).

Emits an [`ERC7579DelayedExecutor.ERC7579ExecutorDelayUpdated`](#ERC7579DelayedExecutor-ERC7579ExecutorDelayUpdated-address-uint32-uint48-) event.

</div>
</div>

<a id="ERC7579DelayedExecutor-_setExpiration-address-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_setExpiration(address account, uint32 newExpiration)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_setExpiration-address-uint32-">#</a>
</div>
</div>
<div className="px-4">

Internal implementation for setting an account's expiration. See [`ERC7579DelayedExecutor.getExpiration`](#ERC7579DelayedExecutor-getExpiration-address-).

Emits an [`ERC7579DelayedExecutor.ERC7579ExecutorExpirationUpdated`](#ERC7579DelayedExecutor-ERC7579ExecutorExpirationUpdated-address-uint32-) event.

</div>
</div>

<a id="ERC7579DelayedExecutor-_scheduleAt-address-bytes32-bytes32-bytes-uint48-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_scheduleAt(address account, bytes32 salt, bytes32 mode, bytes executionCalldata, uint48 timepoint, uint32 delay) → bytes32 operationId, struct ERC7579DelayedExecutor.Schedule schedule_</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_scheduleAt-address-bytes32-bytes32-bytes-uint48-uint32-">#</a>
</div>
</div>
<div className="px-4">

Internal version of [`ERC7579DelayedExecutor.schedule`](#ERC7579DelayedExecutor-schedule-address-bytes32-bytes32-bytes-) that takes an `account` address to schedule
an operation that starts its security window at `at` and expires after `delay`.

Requirements:

* The operation must be `Unknown`.

Emits an [`ERC7579DelayedExecutor.ERC7579ExecutorOperationScheduled`](#ERC7579DelayedExecutor-ERC7579ExecutorOperationScheduled-address-bytes32-bytes32-bytes32-bytes-uint48-) event.

</div>
</div>

<a id="ERC7579DelayedExecutor-_execute-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_execute(address account, bytes32 salt, bytes32 mode, bytes executionCalldata) → bytes[] returnData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_execute-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

See [`ERC7579Executor._execute`](#ERC7579Executor-_execute-address-bytes32-bytes32-bytes-).

Requirements:

* The operation must be `Ready`.

</div>
</div>

<a id="ERC7579DelayedExecutor-_cancel-address-bytes32-bytes-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_cancel(address account, bytes32 mode, bytes executionCalldata, bytes32 salt)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_cancel-address-bytes32-bytes-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Internal version of [`ERC7579DelayedExecutor.cancel`](#ERC7579DelayedExecutor-cancel-address-bytes32-bytes32-bytes-) that takes an `account` address as an argument.

Requirements:

* The operation must be `Scheduled` or `Ready`.

Canceled operations can't be rescheduled. Emits an [`ERC7579DelayedExecutor.ERC7579ExecutorOperationCanceled`](#ERC7579DelayedExecutor-ERC7579ExecutorOperationCanceled-address-bytes32-) event.

</div>
</div>

<a id="ERC7579DelayedExecutor-_validateStateBitmap-bytes32-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateStateBitmap(bytes32 operationId, bytes32 allowedStates) → enum ERC7579DelayedExecutor.OperationState</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_validateStateBitmap-bytes32-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Check that the current state of a operation matches the requirements described by the `allowedStates` bitmap.
This bitmap should be built using [`ERC7579DelayedExecutor._encodeStateBitmap`](#ERC7579DelayedExecutor-_encodeStateBitmap-enum-ERC7579DelayedExecutor-OperationState-).

If requirements are not met, reverts with a [`ERC7579DelayedExecutor.ERC7579ExecutorUnexpectedOperationState`](#ERC7579DelayedExecutor-ERC7579ExecutorUnexpectedOperationState-bytes32-enum-ERC7579DelayedExecutor-OperationState-bytes32-) error.

</div>
</div>

<a id="ERC7579DelayedExecutor-_encodeStateBitmap-enum-ERC7579DelayedExecutor-OperationState-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_encodeStateBitmap(enum ERC7579DelayedExecutor.OperationState operationState) → bytes32</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-_encodeStateBitmap-enum-ERC7579DelayedExecutor-OperationState-">#</a>
</div>
</div>
<div className="px-4">

Encodes a `OperationState` into a `bytes32` representation where each bit enabled corresponds to
the underlying position in the `OperationState` enum. For example:

```
0x000...10000
  ^^^^^^------ ...
        ^----- Canceled
         ^---- Executed
          ^--- Ready
           ^-- Scheduled
            ^- Unknown
```

</div>
</div>

<a id="ERC7579DelayedExecutor-ERC7579ExecutorOperationScheduled-address-bytes32-bytes32-bytes32-bytes-uint48-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorOperationScheduled(address indexed account, bytes32 indexed operationId, bytes32 salt, bytes32 mode, bytes executionCalldata, uint48 schedule)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-ERC7579ExecutorOperationScheduled-address-bytes32-bytes32-bytes32-bytes-uint48-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a new operation is scheduled.

</div>
</div>
<a id="ERC7579DelayedExecutor-ERC7579ExecutorOperationCanceled-address-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorOperationCanceled(address indexed account, bytes32 indexed operationId)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-ERC7579ExecutorOperationCanceled-address-bytes32-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a new operation is canceled.

</div>
</div>
<a id="ERC7579DelayedExecutor-ERC7579ExecutorDelayUpdated-address-uint32-uint48-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorDelayUpdated(address indexed account, uint32 newDelay, uint48 effectTime)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-ERC7579ExecutorDelayUpdated-address-uint32-uint48-">#</a>
</div>
</div>

<div className="px-4">

Emitted when the execution delay is updated.

</div>
</div>
<a id="ERC7579DelayedExecutor-ERC7579ExecutorExpirationUpdated-address-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorExpirationUpdated(address indexed account, uint32 newExpiration)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-ERC7579ExecutorExpirationUpdated-address-uint32-">#</a>
</div>
</div>

<div className="px-4">

Emitted when the expiration delay is updated.

</div>
</div>

<a id="ERC7579DelayedExecutor-ERC7579ExecutorUnexpectedOperationState-bytes32-enum-ERC7579DelayedExecutor-OperationState-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorUnexpectedOperationState(bytes32 operationId, enum ERC7579DelayedExecutor.OperationState currentState, bytes32 allowedStates)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-ERC7579ExecutorUnexpectedOperationState-bytes32-enum-ERC7579DelayedExecutor-OperationState-bytes32-">#</a>
</div>
</div>
<div className="px-4">

The current state of a operation is not the expected. The `expectedStates` is a bitmap with the
bits enabled for each OperationState enum position counting from right to left. See [`ERC7579DelayedExecutor._encodeStateBitmap`](#ERC7579DelayedExecutor-_encodeStateBitmap-enum-ERC7579DelayedExecutor-OperationState-).

<Callout>
If `expectedState` is `bytes32(0)`, the operation is expected to not be in any state (i.e. not exist).
</Callout>

</div>
</div>

<a id="ERC7579DelayedExecutor-ERC7579ExecutorModuleNotInstalled--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorModuleNotInstalled()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579DelayedExecutor-ERC7579ExecutorModuleNotInstalled--">#</a>
</div>
</div>
<div className="px-4">

The module is not installed on the account.

</div>
</div>

<a id="ERC7579Executor"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579Executor`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579Executor.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579Executor.sol";
```

Basic implementation for ERC-7579 executor modules that provides execution functionality
for smart accounts.

The module enables accounts to execute arbitrary operations, leveraging the execution
capabilities defined in the ERC-7579 standard. Developers can customize whether an operation
can be executed with custom rules by implementing the [`ERC7579DelayedExecutor._validateExecution`](#ERC7579DelayedExecutor-_validateExecution-address-bytes32-bytes32-bytes-) function in
derived contracts.

<Callout>
This is a simplified executor that directly executes operations without delay or expiration
mechanisms. For a more advanced implementation with time-delayed execution patterns and
security features, see [`ERC7579DelayedExecutor`](#ERC7579DelayedExecutor).
</Callout>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [isModuleType(moduleTypeId)](#ERC7579Executor-isModuleType-uint256-)
- [execute(account, salt, mode, data)](#ERC7579Executor-execute-address-bytes32-bytes32-bytes-)
- [_validateExecution(account, salt, mode, data)](#ERC7579Executor-_validateExecution-address-bytes32-bytes32-bytes-)
- [_execute(account, mode, salt, executionCalldata)](#ERC7579Executor-_execute-address-bytes32-bytes32-bytes-)
#### IERC7579Module [!toc]
- [onInstall(data)](#IERC7579Module-onInstall-bytes-)
- [onUninstall(data)](#IERC7579Module-onUninstall-bytes-)
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7579ExecutorOperationExecuted(account, salt, mode, executionCalldata)](#ERC7579Executor-ERC7579ExecutorOperationExecuted-address-bytes32-bytes32-bytes-)
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579Executor-isModuleType-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">isModuleType(uint256 moduleTypeId) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Executor-isModuleType-uint256-">#</a>
</div>
</div>
<div className="px-4">

Returns boolean value if module is a certain type

</div>
</div>

<a id="ERC7579Executor-execute-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">execute(address account, bytes32 salt, bytes32 mode, bytes data) → bytes[] returnData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Executor-execute-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Executes an operation and returns the result data from the executed operation.
Restricted to the account itself by default. See [`ERC7579DelayedExecutor._execute`](#ERC7579DelayedExecutor-_execute-address-bytes32-bytes32-bytes-) for requirements and
[`ERC7579DelayedExecutor._validateExecution`](#ERC7579DelayedExecutor-_validateExecution-address-bytes32-bytes32-bytes-) for authorization checks.

</div>
</div>

<a id="ERC7579Executor-_validateExecution-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateExecution(address account, bytes32 salt, bytes32 mode, bytes data) → bytes</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Executor-_validateExecution-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Validates whether the execution can proceed. This function is called before executing
the operation and returns the execution calldata to be used.

Example extension:

```solidity
 function _validateExecution(address account, bytes32 salt, bytes32 mode, bytes calldata data)
     internal
     override
     returns (bytes calldata)
 {
     // custom logic
     return data;
 }
```

<Callout>
Pack extra data in the `data` arguments (e.g. a signature) to be used in the
validation process. Calldata can be sliced to extract it and return only the
execution calldata.
</Callout>

</div>
</div>

<a id="ERC7579Executor-_execute-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_execute(address account, bytes32 mode, bytes32 salt, bytes executionCalldata) → bytes[] returnData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Executor-_execute-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Internal version of [`ERC7579Executor.execute`](#ERC7579Executor-execute-address-bytes32-bytes32-bytes-). Emits [`ERC7579Executor.ERC7579ExecutorOperationExecuted`](#ERC7579Executor-ERC7579ExecutorOperationExecuted-address-bytes32-bytes32-bytes-) event.

Requirements:

* The `account` must implement the `IERC7579Execution-executeFromExecutor` function.

</div>
</div>

<a id="ERC7579Executor-ERC7579ExecutorOperationExecuted-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorOperationExecuted(address indexed account, bytes32 salt, bytes32 mode, bytes executionCalldata)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579Executor-ERC7579ExecutorOperationExecuted-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>

<div className="px-4">

Emitted when an operation is executed.

</div>
</div>

<a id="ERC7579Multisig"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579Multisig`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579Multisig.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579Multisig.sol";
```

Implementation of an [`ERC7579Validator`](#ERC7579Validator) that uses ERC-7913 signers for multisignature
validation.

This module provides a base implementation for multisignature validation that can be
attached to any function through the [`ERC7579Multisig._rawERC7579Validation`](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-) internal function. The signers
are represented using the ERC-7913 format, which concatenates a verifier address and
a key: `verifier || key`.

A smart account with this module installed can require multiple signers to approve
operations before they are executed, such as requiring 3-of-5 guardians to approve
a social recovery operation.

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [onInstall(initData)](#ERC7579Multisig-onInstall-bytes-)
- [onUninstall()](#ERC7579Multisig-onUninstall-bytes-)
- [getSigners(account, start, end)](#ERC7579Multisig-getSigners-address-uint64-uint64-)
- [getSignerCount(account)](#ERC7579Multisig-getSignerCount-address-)
- [isSigner(account, signer)](#ERC7579Multisig-isSigner-address-bytes-)
- [threshold(account)](#ERC7579Multisig-threshold-address-)
- [addSigners(newSigners)](#ERC7579Multisig-addSigners-bytes---)
- [removeSigners(oldSigners)](#ERC7579Multisig-removeSigners-bytes---)
- [setThreshold(newThreshold)](#ERC7579Multisig-setThreshold-uint64-)
- [_rawERC7579Validation(account, hash, signature)](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-)
- [_addSigners(account, newSigners)](#ERC7579Multisig-_addSigners-address-bytes---)
- [_removeSigners(account, oldSigners)](#ERC7579Multisig-_removeSigners-address-bytes---)
- [_setThreshold(account, newThreshold)](#ERC7579Multisig-_setThreshold-address-uint64-)
- [_validateReachableThreshold(account)](#ERC7579Multisig-_validateReachableThreshold-address-)
- [_validateSignatures(account, hash, signingSigners, signatures)](#ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---)
- [_validateThreshold(account, validatingSigners)](#ERC7579Multisig-_validateThreshold-address-bytes---)
#### ERC7579Validator [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Validator-isModuleType-uint256-)
- [validateUserOp(userOp, userOpHash)](#ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-)
- [isValidSignatureWithSender(, hash, signature)](#ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-)
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7913SignerAdded(account, signer)](#ERC7579Multisig-ERC7913SignerAdded-address-bytes-)
- [ERC7913SignerRemoved(account, signer)](#ERC7579Multisig-ERC7913SignerRemoved-address-bytes-)
- [ERC7913ThresholdSet(account, threshold)](#ERC7579Multisig-ERC7913ThresholdSet-address-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [ERC7579MultisigAlreadyExists(signer)](#ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-)
- [ERC7579MultisigNonexistentSigner(signer)](#ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-)
- [ERC7579MultisigInvalidSigner(signer)](#ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-)
- [ERC7579MultisigZeroThreshold()](#ERC7579Multisig-ERC7579MultisigZeroThreshold--)
- [ERC7579MultisigUnreachableThreshold(signers, threshold)](#ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579Multisig-onInstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onInstall(bytes initData)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-onInstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Sets up the module's initial configuration when installed by an account.
See [`ERC7579DelayedExecutor.onInstall`](#ERC7579DelayedExecutor-onInstall-bytes-). Besides the delay setup, the `initdata` can
include `signers` and `threshold`.

The initData should be encoded as:
`abi.encode(bytes[] signers, uint64 threshold)`

If no signers or threshold are provided, the multisignature functionality will be
disabled until they are added later.

<Callout>
An account can only call onInstall once. If called directly by the account,
the signer will be set to the provided data. Future installations will behave as a no-op.
</Callout>

</div>
</div>

<a id="ERC7579Multisig-onUninstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onUninstall(bytes)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-onUninstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Cleans up module's configuration when uninstalled from an account.
Clears all signers and resets the threshold.

See [`ERC7579DelayedExecutor.onUninstall`](#ERC7579DelayedExecutor-onUninstall-bytes-).

<Callout type="warn">
This function has unbounded gas costs and may become uncallable if the set grows too large.
See `EnumerableSet-clear`.
</Callout>

</div>
</div>

<a id="ERC7579Multisig-getSigners-address-uint64-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">getSigners(address account, uint64 start, uint64 end) → bytes[]</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-getSigners-address-uint64-uint64-">#</a>
</div>
</div>
<div className="px-4">

Returns a slice of the set of authorized signers for the specified account.

Using `start = 0` and `end = type(uint64).max` will return the entire set of signers.

<Callout type="warn">
Depending on the `start` and `end`, this operation can copy a large amount of data to memory, which
can be expensive. This is designed for view accessors queried without gas fees. Using it in state-changing
functions may become uncallable if the slice grows too large.
</Callout>

</div>
</div>

<a id="ERC7579Multisig-getSignerCount-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">getSignerCount(address account) → uint256</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-getSignerCount-address-">#</a>
</div>
</div>
<div className="px-4">

Returns the number of authorized signers for the specified account.

</div>
</div>

<a id="ERC7579Multisig-isSigner-address-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">isSigner(address account, bytes signer) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-isSigner-address-bytes-">#</a>
</div>
</div>
<div className="px-4">

Returns whether the `signer` is an authorized signer for the specified account.

</div>
</div>

<a id="ERC7579Multisig-threshold-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">threshold(address account) → uint64</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-threshold-address-">#</a>
</div>
</div>
<div className="px-4">

Returns the minimum number of signers required to approve a multisignature operation
for the specified account.

</div>
</div>

<a id="ERC7579Multisig-addSigners-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">addSigners(bytes[] newSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-addSigners-bytes---">#</a>
</div>
</div>
<div className="px-4">

Adds new signers to the authorized set for the calling account.
Can only be called by the account itself.

Requirements:

* Each of `newSigners` must be at least 20 bytes long.
* Each of `newSigners` must not be already authorized.

</div>
</div>

<a id="ERC7579Multisig-removeSigners-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">removeSigners(bytes[] oldSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-removeSigners-bytes---">#</a>
</div>
</div>
<div className="px-4">

Removes signers from the authorized set for the calling account.
Can only be called by the account itself.

Requirements:

* Each of `oldSigners` must be authorized.
* After removal, the threshold must still be reachable.

</div>
</div>

<a id="ERC7579Multisig-setThreshold-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">setThreshold(uint64 newThreshold)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Multisig-setThreshold-uint64-">#</a>
</div>
</div>
<div className="px-4">

Sets the threshold for the calling account.
Can only be called by the account itself.

Requirements:

* The threshold must be reachable with the current number of signers.

</div>
</div>

<a id="ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_rawERC7579Validation(address account, bytes32 hash, bytes signature) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Returns whether the number of valid signatures meets or exceeds the
threshold set for the target account.

The signature should be encoded as:
`abi.encode(bytes[] signingSigners, bytes[] signatures)`

Where `signingSigners` are the authorized signers and signatures are their corresponding
signatures of the operation `hash`.

</div>
</div>

<a id="ERC7579Multisig-_addSigners-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_addSigners(address account, bytes[] newSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_addSigners-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Adds the `newSigners` to those allowed to sign on behalf of the account.

Requirements:

* Each of `newSigners` must be at least 20 bytes long. Reverts with [`ERC7579Multisig.ERC7579MultisigInvalidSigner`](#ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-) if not.
* Each of `newSigners` must not be authorized. Reverts with [`ERC7579Multisig.ERC7579MultisigAlreadyExists`](#ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-) if it already exists.

</div>
</div>

<a id="ERC7579Multisig-_removeSigners-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_removeSigners(address account, bytes[] oldSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_removeSigners-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Removes the `oldSigners` from the authorized signers for the account.

Requirements:

* Each of `oldSigners` must be authorized. Reverts with [`ERC7579Multisig.ERC7579MultisigNonexistentSigner`](#ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-) if not.
* The threshold must remain reachable after removal. See [`ERC7579Multisig._validateReachableThreshold`](#ERC7579Multisig-_validateReachableThreshold-address-) for details.

</div>
</div>

<a id="ERC7579Multisig-_setThreshold-address-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_setThreshold(address account, uint64 newThreshold)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_setThreshold-address-uint64-">#</a>
</div>
</div>
<div className="px-4">

Sets the signatures `threshold` required to approve a multisignature operation.

Requirements:

* The threshold must be greater than 0. Reverts with [`ERC7579Multisig.ERC7579MultisigZeroThreshold`](#ERC7579Multisig-ERC7579MultisigZeroThreshold--) if not.
* The threshold must be reachable with the current number of signers. See [`ERC7579Multisig._validateReachableThreshold`](#ERC7579Multisig-_validateReachableThreshold-address-) for details.

</div>
</div>

<a id="ERC7579Multisig-_validateReachableThreshold-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateReachableThreshold(address account)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_validateReachableThreshold-address-">#</a>
</div>
</div>
<div className="px-4">

Validates the current threshold is reachable with the number of [`ERC7579Multisig._signersSetByAccount`](#ERC7579Multisig-_signersSetByAccount-mapping-address----struct-EnumerableSet-BytesSet-).

Requirements:

* The number of signers must be >= the threshold. Reverts with [`ERC7579Multisig.ERC7579MultisigUnreachableThreshold`](#ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-) if not.

</div>
</div>

<a id="ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateSignatures(address account, bytes32 hash, bytes[] signingSigners, bytes[] signatures) → bool valid</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---">#</a>
</div>
</div>
<div className="px-4">

Validates the signatures using the signers and their corresponding signatures.
Returns whether the signers are authorized and the signatures are valid for the given hash.

The signers must be ordered by their `keccak256` hash to prevent duplications and to optimize
the verification process. The function will return `false` if any signer is not authorized or
if the signatures are invalid for the given hash.

Requirements:

* The `signatures` array must be at least the `signers` array's length.

</div>
</div>

<a id="ERC7579Multisig-_validateThreshold-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateThreshold(address account, bytes[] validatingSigners) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Multisig-_validateThreshold-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Validates that the number of signers meets the [`ERC7579Multisig.threshold`](#ERC7579Multisig-threshold-address-) requirement.
Assumes the signers were already validated. See [`ERC7579Multisig._validateSignatures`](#ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---) for more details.

</div>
</div>

<a id="ERC7579Multisig-ERC7913SignerAdded-address-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7913SignerAdded(address indexed account, bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7913SignerAdded-address-bytes-">#</a>
</div>
</div>

<div className="px-4">

Emitted when signers are added.

</div>
</div>
<a id="ERC7579Multisig-ERC7913SignerRemoved-address-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7913SignerRemoved(address indexed account, bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7913SignerRemoved-address-bytes-">#</a>
</div>
</div>

<div className="px-4">

Emitted when signers are removed.

</div>
</div>
<a id="ERC7579Multisig-ERC7913ThresholdSet-address-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7913ThresholdSet(address indexed account, uint64 threshold)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7913ThresholdSet-address-uint64-">#</a>
</div>
</div>

<div className="px-4">

Emitted when the threshold is updated.

</div>
</div>

<a id="ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigAlreadyExists(bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-">#</a>
</div>
</div>
<div className="px-4">

The `signer` already exists.

</div>
</div>

<a id="ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigNonexistentSigner(bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-">#</a>
</div>
</div>
<div className="px-4">

The `signer` does not exist.

</div>
</div>

<a id="ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigInvalidSigner(bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-">#</a>
</div>
</div>
<div className="px-4">

The `signer` is less than 20 bytes long.

</div>
</div>

<a id="ERC7579Multisig-ERC7579MultisigZeroThreshold--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigZeroThreshold()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7579MultisigZeroThreshold--">#</a>
</div>
</div>
<div className="px-4">

The `threshold` is zero.

</div>
</div>

<a id="ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigUnreachableThreshold(uint64 signers, uint64 threshold)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-">#</a>
</div>
</div>
<div className="px-4">

The `threshold` is unreachable given the number of `signers`.

</div>
</div>

<a id="ERC7579MultisigConfirmation"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579MultisigConfirmation`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579MultisigConfirmation.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579MultisigConfirmation.sol";
```

Extension of [`ERC7579Multisig`](#ERC7579Multisig) that requires explicit confirmation signatures
from new signers when they are being added to the multisig.

This module ensures that only willing participants can be added as signers to a
multisig by requiring each new signer to provide a valid signature confirming their
consent to be added. Each signer must sign an EIP-712 message to confirm their addition.

<Callout>
Use this module to ensure that all guardians in a social recovery or multisig setup have
explicitly agreed to their roles.
</Callout>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [_signableConfirmationHash(account, deadline)](#ERC7579MultisigConfirmation-_signableConfirmationHash-address-uint256-)
- [_addSigners(account, newSigners)](#ERC7579MultisigConfirmation-_addSigners-address-bytes---)
#### EIP712 [!toc]
- [_domainSeparatorV4()](#EIP712-_domainSeparatorV4--)
- [_hashTypedDataV4(structHash)](#EIP712-_hashTypedDataV4-bytes32-)
- [eip712Domain()](#EIP712-eip712Domain--)
- [_EIP712Name()](#EIP712-_EIP712Name--)
- [_EIP712Version()](#EIP712-_EIP712Version--)
#### IERC5267 [!toc]
#### ERC7579Multisig [!toc]
- [onInstall(initData)](#ERC7579Multisig-onInstall-bytes-)
- [onUninstall()](#ERC7579Multisig-onUninstall-bytes-)
- [getSigners(account, start, end)](#ERC7579Multisig-getSigners-address-uint64-uint64-)
- [getSignerCount(account)](#ERC7579Multisig-getSignerCount-address-)
- [isSigner(account, signer)](#ERC7579Multisig-isSigner-address-bytes-)
- [threshold(account)](#ERC7579Multisig-threshold-address-)
- [addSigners(newSigners)](#ERC7579Multisig-addSigners-bytes---)
- [removeSigners(oldSigners)](#ERC7579Multisig-removeSigners-bytes---)
- [setThreshold(newThreshold)](#ERC7579Multisig-setThreshold-uint64-)
- [_rawERC7579Validation(account, hash, signature)](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-)
- [_removeSigners(account, oldSigners)](#ERC7579Multisig-_removeSigners-address-bytes---)
- [_setThreshold(account, newThreshold)](#ERC7579Multisig-_setThreshold-address-uint64-)
- [_validateReachableThreshold(account)](#ERC7579Multisig-_validateReachableThreshold-address-)
- [_validateSignatures(account, hash, signingSigners, signatures)](#ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---)
- [_validateThreshold(account, validatingSigners)](#ERC7579Multisig-_validateThreshold-address-bytes---)
#### ERC7579Validator [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Validator-isModuleType-uint256-)
- [validateUserOp(userOp, userOpHash)](#ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-)
- [isValidSignatureWithSender(, hash, signature)](#ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-)
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
#### EIP712 [!toc]
#### IERC5267 [!toc]
- [EIP712DomainChanged()](#IERC5267-EIP712DomainChanged--)
#### ERC7579Multisig [!toc]
- [ERC7913SignerAdded(account, signer)](#ERC7579Multisig-ERC7913SignerAdded-address-bytes-)
- [ERC7913SignerRemoved(account, signer)](#ERC7579Multisig-ERC7913SignerRemoved-address-bytes-)
- [ERC7913ThresholdSet(account, threshold)](#ERC7579Multisig-ERC7913ThresholdSet-address-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [ERC7579MultisigInvalidConfirmationSignature(signer)](#ERC7579MultisigConfirmation-ERC7579MultisigInvalidConfirmationSignature-bytes-)
- [ERC7579MultisigExpiredConfirmation(deadline)](#ERC7579MultisigConfirmation-ERC7579MultisigExpiredConfirmation-uint256-)
#### EIP712 [!toc]
#### IERC5267 [!toc]
#### ERC7579Multisig [!toc]
- [ERC7579MultisigAlreadyExists(signer)](#ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-)
- [ERC7579MultisigNonexistentSigner(signer)](#ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-)
- [ERC7579MultisigInvalidSigner(signer)](#ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-)
- [ERC7579MultisigZeroThreshold()](#ERC7579Multisig-ERC7579MultisigZeroThreshold--)
- [ERC7579MultisigUnreachableThreshold(signers, threshold)](#ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579MultisigConfirmation-_signableConfirmationHash-address-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_signableConfirmationHash(address account, uint256 deadline) → bytes32</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigConfirmation-_signableConfirmationHash-address-uint256-">#</a>
</div>
</div>
<div className="px-4">

Generates a hash that signers must sign to confirm their addition to the multisig of `account`.

</div>
</div>

<a id="ERC7579MultisigConfirmation-_addSigners-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_addSigners(address account, bytes[] newSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigConfirmation-_addSigners-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Extends [`ERC7579Multisig._addSigners`](#ERC7579Multisig-_addSigners-address-bytes---) _addSigners to require confirmation signatures
Each entry in newSigners must be ABI-encoded as:

```solidity
abi.encode(deadline,signer,signature); // uint256, bytes, bytes
```

* signer: The ERC-7913 signer to add
* signature: The signature from this signer confirming their addition

The function verifies each signature before adding the signer. If any signature is invalid,
the function reverts with [`ERC7579MultisigConfirmation.ERC7579MultisigInvalidConfirmationSignature`](#ERC7579MultisigConfirmation-ERC7579MultisigInvalidConfirmationSignature-bytes-).

</div>
</div>

<a id="ERC7579MultisigConfirmation-ERC7579MultisigInvalidConfirmationSignature-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigInvalidConfirmationSignature(bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579MultisigConfirmation-ERC7579MultisigInvalidConfirmationSignature-bytes-">#</a>
</div>
</div>
<div className="px-4">

Error thrown when a `signer`'s confirmation signature is invalid

</div>
</div>

<a id="ERC7579MultisigConfirmation-ERC7579MultisigExpiredConfirmation-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigExpiredConfirmation(uint256 deadline)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579MultisigConfirmation-ERC7579MultisigExpiredConfirmation-uint256-">#</a>
</div>
</div>
<div className="px-4">

Error thrown when a confirmation signature has expired

</div>
</div>

<a id="ERC7579MultisigStorage"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579MultisigStorage`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579MultisigStorage.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579MultisigStorage.sol";
```

Extension of [`ERC7579Multisig`](#ERC7579Multisig) that allows storing presigned approvals in storage.

This module extends the multisignature module to allow signers to presign operations,
which are then stored in a mapping and can be used during validation. This enables
more flexible multisignature workflows where signatures can be collected over time
without requiring all signers to be online simultaneously.

When validating signatures, if a signature is empty, it indicates a presignature
and the validation will check the storage mapping instead of cryptographic verification.

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [presigned(account, signer, hash)](#ERC7579MultisigStorage-presigned-address-bytes-bytes32-)
- [presign(account, signer, hash, signature)](#ERC7579MultisigStorage-presign-address-bytes-bytes32-bytes-)
- [_validateSignatures(account, hash, signingSigners, signatures)](#ERC7579MultisigStorage-_validateSignatures-address-bytes32-bytes---bytes---)
#### ERC7579Multisig [!toc]
- [onInstall(initData)](#ERC7579Multisig-onInstall-bytes-)
- [onUninstall()](#ERC7579Multisig-onUninstall-bytes-)
- [getSigners(account, start, end)](#ERC7579Multisig-getSigners-address-uint64-uint64-)
- [getSignerCount(account)](#ERC7579Multisig-getSignerCount-address-)
- [isSigner(account, signer)](#ERC7579Multisig-isSigner-address-bytes-)
- [threshold(account)](#ERC7579Multisig-threshold-address-)
- [addSigners(newSigners)](#ERC7579Multisig-addSigners-bytes---)
- [removeSigners(oldSigners)](#ERC7579Multisig-removeSigners-bytes---)
- [setThreshold(newThreshold)](#ERC7579Multisig-setThreshold-uint64-)
- [_rawERC7579Validation(account, hash, signature)](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-)
- [_addSigners(account, newSigners)](#ERC7579Multisig-_addSigners-address-bytes---)
- [_removeSigners(account, oldSigners)](#ERC7579Multisig-_removeSigners-address-bytes---)
- [_setThreshold(account, newThreshold)](#ERC7579Multisig-_setThreshold-address-uint64-)
- [_validateReachableThreshold(account)](#ERC7579Multisig-_validateReachableThreshold-address-)
- [_validateThreshold(account, validatingSigners)](#ERC7579Multisig-_validateThreshold-address-bytes---)
#### ERC7579Validator [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Validator-isModuleType-uint256-)
- [validateUserOp(userOp, userOpHash)](#ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-)
- [isValidSignatureWithSender(, hash, signature)](#ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-)
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7579MultisigStoragePresigned(account, hash, signer)](#ERC7579MultisigStorage-ERC7579MultisigStoragePresigned-address-bytes32-bytes-)
#### ERC7579Multisig [!toc]
- [ERC7913SignerAdded(account, signer)](#ERC7579Multisig-ERC7913SignerAdded-address-bytes-)
- [ERC7913SignerRemoved(account, signer)](#ERC7579Multisig-ERC7913SignerRemoved-address-bytes-)
- [ERC7913ThresholdSet(account, threshold)](#ERC7579Multisig-ERC7913ThresholdSet-address-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
#### ERC7579Multisig [!toc]
- [ERC7579MultisigAlreadyExists(signer)](#ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-)
- [ERC7579MultisigNonexistentSigner(signer)](#ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-)
- [ERC7579MultisigInvalidSigner(signer)](#ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-)
- [ERC7579MultisigZeroThreshold()](#ERC7579Multisig-ERC7579MultisigZeroThreshold--)
- [ERC7579MultisigUnreachableThreshold(signers, threshold)](#ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579MultisigStorage-presigned-address-bytes-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">presigned(address account, bytes signer, bytes32 hash) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigStorage-presigned-address-bytes-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Returns whether a signer has presigned a specific hash for the account

</div>
</div>

<a id="ERC7579MultisigStorage-presign-address-bytes-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">presign(address account, bytes signer, bytes32 hash, bytes signature)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigStorage-presign-address-bytes-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Allows a signer to presign a hash by providing a valid signature.
The signature will be verified and if valid, the presignature will be stored.

Emits [`ERC7579MultisigStorage.ERC7579MultisigStoragePresigned`](#ERC7579MultisigStorage-ERC7579MultisigStoragePresigned-address-bytes32-bytes-) if the signature is valid and the hash is not already
signed, otherwise acts as a no-op.

<Callout>
Does not check if the signer is authorized for the account. Valid signatures from
invalid signers won't be executable. See [`ERC7579Multisig._validateSignatures`](#ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---) for more details.
</Callout>

</div>
</div>

<a id="ERC7579MultisigStorage-_validateSignatures-address-bytes32-bytes---bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateSignatures(address account, bytes32 hash, bytes[] signingSigners, bytes[] signatures) → bool valid</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigStorage-_validateSignatures-address-bytes32-bytes---bytes---">#</a>
</div>
</div>
<div className="px-4">

See [`ERC7579Multisig._validateSignatures`](#ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---).

If a signature is empty, it indicates a presignature and the validation will check the storage mapping
instead of cryptographic verification. See [`ERC7579Multisig._signersSetByAccount`](#ERC7579Multisig-_signersSetByAccount-mapping-address----struct-EnumerableSet-BytesSet-) for more details.

</div>
</div>

<a id="ERC7579MultisigStorage-ERC7579MultisigStoragePresigned-address-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigStoragePresigned(address indexed account, bytes32 indexed hash, bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579MultisigStorage-ERC7579MultisigStoragePresigned-address-bytes32-bytes-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a signer signs a hash

</div>
</div>

<a id="ERC7579MultisigWeighted"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579MultisigWeighted`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579MultisigWeighted.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579MultisigWeighted.sol";
```

Extension of [`ERC7579Multisig`](#ERC7579Multisig) that supports weighted signatures.

This module extends the multisignature module to allow assigning different weights
to each signer, enabling more flexible governance schemes. For example, some guardians
could have higher weight than others, allowing for weighted voting or prioritized authorization.

Example use case:

A smart account with this module installed can schedule social recovery operations
after obtaining approval from guardians with sufficient total weight (e.g., requiring
a total weight of 10, with 3 guardians weighted as 5, 3, and 2), and then execute them
after the time delay has passed.

<Callout type="warn">
When setting a threshold value, ensure it matches the scale used for signer weights.
For example, if signers have weights like 1, 2, or 3, then a threshold of 4 would require
signatures with a total weight of at least 4 (e.g., one with weight 1 and one with weight 3).
</Callout>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [onInstall(initData)](#ERC7579MultisigWeighted-onInstall-bytes-)
- [onUninstall(data)](#ERC7579MultisigWeighted-onUninstall-bytes-)
- [signerWeight(account, signer)](#ERC7579MultisigWeighted-signerWeight-address-bytes-)
- [totalWeight(account)](#ERC7579MultisigWeighted-totalWeight-address-)
- [setSignerWeights(signers, weights)](#ERC7579MultisigWeighted-setSignerWeights-bytes---uint64---)
- [_setSignerWeights(account, signers, weights)](#ERC7579MultisigWeighted-_setSignerWeights-address-bytes---uint64---)
- [_addSigners(account, newSigners)](#ERC7579MultisigWeighted-_addSigners-address-bytes---)
- [_removeSigners(account, oldSigners)](#ERC7579MultisigWeighted-_removeSigners-address-bytes---)
- [_validateReachableThreshold(account)](#ERC7579MultisigWeighted-_validateReachableThreshold-address-)
- [_validateThreshold(account, validatingSigners)](#ERC7579MultisigWeighted-_validateThreshold-address-bytes---)
#### ERC7579Multisig [!toc]
- [getSigners(account, start, end)](#ERC7579Multisig-getSigners-address-uint64-uint64-)
- [getSignerCount(account)](#ERC7579Multisig-getSignerCount-address-)
- [isSigner(account, signer)](#ERC7579Multisig-isSigner-address-bytes-)
- [threshold(account)](#ERC7579Multisig-threshold-address-)
- [addSigners(newSigners)](#ERC7579Multisig-addSigners-bytes---)
- [removeSigners(oldSigners)](#ERC7579Multisig-removeSigners-bytes---)
- [setThreshold(newThreshold)](#ERC7579Multisig-setThreshold-uint64-)
- [_rawERC7579Validation(account, hash, signature)](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-)
- [_setThreshold(account, newThreshold)](#ERC7579Multisig-_setThreshold-address-uint64-)
- [_validateSignatures(account, hash, signingSigners, signatures)](#ERC7579Multisig-_validateSignatures-address-bytes32-bytes---bytes---)
#### ERC7579Validator [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Validator-isModuleType-uint256-)
- [validateUserOp(userOp, userOpHash)](#ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-)
- [isValidSignatureWithSender(, hash, signature)](#ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-)
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7579MultisigWeightChanged(account, signer, weight)](#ERC7579MultisigWeighted-ERC7579MultisigWeightChanged-address-bytes-uint64-)
#### ERC7579Multisig [!toc]
- [ERC7913SignerAdded(account, signer)](#ERC7579Multisig-ERC7913SignerAdded-address-bytes-)
- [ERC7913SignerRemoved(account, signer)](#ERC7579Multisig-ERC7913SignerRemoved-address-bytes-)
- [ERC7913ThresholdSet(account, threshold)](#ERC7579Multisig-ERC7913ThresholdSet-address-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [ERC7579MultisigInvalidWeight(signer, weight)](#ERC7579MultisigWeighted-ERC7579MultisigInvalidWeight-bytes-uint64-)
- [ERC7579MultisigMismatchedLength()](#ERC7579MultisigWeighted-ERC7579MultisigMismatchedLength--)
#### ERC7579Multisig [!toc]
- [ERC7579MultisigAlreadyExists(signer)](#ERC7579Multisig-ERC7579MultisigAlreadyExists-bytes-)
- [ERC7579MultisigNonexistentSigner(signer)](#ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-)
- [ERC7579MultisigInvalidSigner(signer)](#ERC7579Multisig-ERC7579MultisigInvalidSigner-bytes-)
- [ERC7579MultisigZeroThreshold()](#ERC7579Multisig-ERC7579MultisigZeroThreshold--)
- [ERC7579MultisigUnreachableThreshold(signers, threshold)](#ERC7579Multisig-ERC7579MultisigUnreachableThreshold-uint64-uint64-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579MultisigWeighted-onInstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onInstall(bytes initData)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-onInstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Sets up the module's initial configuration when installed by an account.
Besides the standard delay and signer configuration, this can also include
signer weights.

The initData should be encoded as:
`abi.encode(bytes[] signers, uint64 threshold, uint64[] weights)`

If weights are not provided but signers are, all signers default to weight 1.

<Callout>
An account can only call onInstall once. If called directly by the account,
the signer will be set to the provided data. Future installations will behave as a no-op.
</Callout>

</div>
</div>

<a id="ERC7579MultisigWeighted-onUninstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onUninstall(bytes data)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-onUninstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Cleans up module's configuration when uninstalled from an account.
Clears all signers, weights, and total weights.

See [`ERC7579Multisig.onUninstall`](#ERC7579Multisig-onUninstall-bytes-).

</div>
</div>

<a id="ERC7579MultisigWeighted-signerWeight-address-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">signerWeight(address account, bytes signer) → uint64</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-signerWeight-address-bytes-">#</a>
</div>
</div>
<div className="px-4">

Gets the weight of a signer for a specific account. Returns 0 if the signer is not authorized.

</div>
</div>

<a id="ERC7579MultisigWeighted-totalWeight-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">totalWeight(address account) → uint64</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-totalWeight-address-">#</a>
</div>
</div>
<div className="px-4">

Gets the total weight of all signers for a specific account.

</div>
</div>

<a id="ERC7579MultisigWeighted-setSignerWeights-bytes---uint64---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">setSignerWeights(bytes[] signers, uint64[] weights)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-setSignerWeights-bytes---uint64---">#</a>
</div>
</div>
<div className="px-4">

Sets weights for signers for the calling account.
Can only be called by the account itself.

</div>
</div>

<a id="ERC7579MultisigWeighted-_setSignerWeights-address-bytes---uint64---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_setSignerWeights(address account, bytes[] signers, uint64[] weights)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-_setSignerWeights-address-bytes---uint64---">#</a>
</div>
</div>
<div className="px-4">

Sets weights for multiple signers at once. Internal version without access control.

Requirements:

* `signers` and `weights` arrays must have the same length. Reverts with [`ERC7579MultisigWeighted.ERC7579MultisigMismatchedLength`](#ERC7579MultisigWeighted-ERC7579MultisigMismatchedLength--) on mismatch.
* Each signer must exist in the set of authorized signers. Reverts with [`ERC7579Multisig.ERC7579MultisigNonexistentSigner`](#ERC7579Multisig-ERC7579MultisigNonexistentSigner-bytes-) if not.
* Each weight must be greater than 0. Reverts with [`ERC7579MultisigWeighted.ERC7579MultisigInvalidWeight`](#ERC7579MultisigWeighted-ERC7579MultisigInvalidWeight-bytes-uint64-) if not.
* See [`ERC7579Multisig._validateReachableThreshold`](#ERC7579Multisig-_validateReachableThreshold-address-) for the threshold validation.

Emits [`ERC7579MultisigWeighted.ERC7579MultisigWeightChanged`](#ERC7579MultisigWeighted-ERC7579MultisigWeightChanged-address-bytes-uint64-) for each signer.

</div>
</div>

<a id="ERC7579MultisigWeighted-_addSigners-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_addSigners(address account, bytes[] newSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-_addSigners-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Override to add weight tracking. See [`ERC7579Multisig._addSigners`](#ERC7579Multisig-_addSigners-address-bytes---).
Each new signer has a default weight of 1.

In cases where [`ERC7579MultisigWeighted.totalWeight`](#ERC7579MultisigWeighted-totalWeight-address-) is almost `type(uint64).max` (due to a large `_totalExtraWeight`), adding new
signers could cause the [`ERC7579MultisigWeighted.totalWeight`](#ERC7579MultisigWeighted-totalWeight-address-) computation to overflow. Adding a [`ERC7579MultisigWeighted.totalWeight`](#ERC7579MultisigWeighted-totalWeight-address-) call after the new
signers are added ensures no such overflow happens.

</div>
</div>

<a id="ERC7579MultisigWeighted-_removeSigners-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_removeSigners(address account, bytes[] oldSigners)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-_removeSigners-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Override to handle weight tracking during removal. See [`ERC7579Multisig._removeSigners`](#ERC7579Multisig-_removeSigners-address-bytes---).

Just like [`ERC7579Multisig._addSigners`](#ERC7579Multisig-_addSigners-address-bytes---), this function does not emit [`ERC7579MultisigWeighted.ERC7579MultisigWeightChanged`](#ERC7579MultisigWeighted-ERC7579MultisigWeightChanged-address-bytes-uint64-) events. The
[`ERC7579Multisig.ERC7913SignerRemoved`](#ERC7579Multisig-ERC7913SignerRemoved-address-bytes-) event emitted by [`ERC7579Multisig._removeSigners`](#ERC7579Multisig-_removeSigners-address-bytes---) is enough to track weights here.

</div>
</div>

<a id="ERC7579MultisigWeighted-_validateReachableThreshold-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateReachableThreshold(address account)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-_validateReachableThreshold-address-">#</a>
</div>
</div>
<div className="px-4">

Override to validate threshold against total weight instead of signer count.

<Callout>
This function intentionally does not call `super._validateReachableThreshold` because the base implementation
assumes each signer has a weight of 1, which is a subset of this weighted implementation. Consider that multiple
implementations of this function may exist in the contract, so important side effects may be missed
depending on the linearization order.
</Callout>

</div>
</div>

<a id="ERC7579MultisigWeighted-_validateThreshold-address-bytes---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateThreshold(address account, bytes[] validatingSigners) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-_validateThreshold-address-bytes---">#</a>
</div>
</div>
<div className="px-4">

Validates that the total weight of signers meets the [`ERC7579Multisig.threshold`](#ERC7579Multisig-threshold-address-) requirement.
Overrides the base implementation to use weights instead of count.

<Callout>
This function intentionally does not call `super._validateThreshold` because the base implementation
assumes each signer has a weight of 1, which is incompatible with this weighted implementation.
</Callout>

</div>
</div>

<a id="ERC7579MultisigWeighted-ERC7579MultisigWeightChanged-address-bytes-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigWeightChanged(address indexed account, bytes indexed signer, uint64 weight)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-ERC7579MultisigWeightChanged-address-bytes-uint64-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a signer's weight is changed.

<Callout>
Not emitted in [`ERC7579Multisig._addSigners`](#ERC7579Multisig-_addSigners-address-bytes---) or [`ERC7579Multisig._removeSigners`](#ERC7579Multisig-_removeSigners-address-bytes---). Indexers must rely on [`ERC7579Multisig.ERC7913SignerAdded`](#ERC7579Multisig-ERC7913SignerAdded-address-bytes-)
and [`ERC7579Multisig.ERC7913SignerRemoved`](#ERC7579Multisig-ERC7913SignerRemoved-address-bytes-) to index a default weight of 1. See [`ERC7579MultisigWeighted.signerWeight`](#ERC7579MultisigWeighted-signerWeight-address-bytes-).
</Callout>

</div>
</div>

<a id="ERC7579MultisigWeighted-ERC7579MultisigInvalidWeight-bytes-uint64-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigInvalidWeight(bytes signer, uint64 weight)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-ERC7579MultisigInvalidWeight-bytes-uint64-">#</a>
</div>
</div>
<div className="px-4">

Thrown when a signer's weight is invalid.

</div>
</div>

<a id="ERC7579MultisigWeighted-ERC7579MultisigMismatchedLength--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579MultisigMismatchedLength()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579MultisigWeighted-ERC7579MultisigMismatchedLength--">#</a>
</div>
</div>
<div className="px-4">

Thrown when the arrays lengths don't match.

</div>
</div>

<a id="ERC7579SelectorExecutor"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579SelectorExecutor`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579SelectorExecutor.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579SelectorExecutor.sol";
```

Implementation of an [`ERC7579Executor`](#ERC7579Executor) that allows authorizing specific function selectors
that can be executed on the account.

This module provides a way to restrict which functions can be executed on the account by
maintaining a set of allowed function selectors. Only calls to functions with selectors
in the set will be allowed to execute.

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [isAuthorized(account, selector)](#ERC7579SelectorExecutor-isAuthorized-address-bytes4-)
- [selectors(account)](#ERC7579SelectorExecutor-selectors-address-)
- [onInstall(initData)](#ERC7579SelectorExecutor-onInstall-bytes-)
- [onUninstall()](#ERC7579SelectorExecutor-onUninstall-bytes-)
- [addSelectors(newSelectors)](#ERC7579SelectorExecutor-addSelectors-bytes4---)
- [removeSelectors(oldSelectors)](#ERC7579SelectorExecutor-removeSelectors-bytes4---)
- [_addSelectors(account, newSelectors)](#ERC7579SelectorExecutor-_addSelectors-address-bytes4---)
- [_removeSelectors(account, oldSelectors)](#ERC7579SelectorExecutor-_removeSelectors-address-bytes4---)
- [_validateExecution(account, , , data)](#ERC7579SelectorExecutor-_validateExecution-address-bytes32-bytes32-bytes-)
#### ERC7579Executor [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Executor-isModuleType-uint256-)
- [execute(account, salt, mode, data)](#ERC7579Executor-execute-address-bytes32-bytes32-bytes-)
- [_execute(account, mode, salt, executionCalldata)](#ERC7579Executor-_execute-address-bytes32-bytes32-bytes-)
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7579ExecutorSelectorAuthorized(account, selector)](#ERC7579SelectorExecutor-ERC7579ExecutorSelectorAuthorized-address-bytes4-)
- [ERC7579ExecutorSelectorRemoved(account, selector)](#ERC7579SelectorExecutor-ERC7579ExecutorSelectorRemoved-address-bytes4-)
#### ERC7579Executor [!toc]
- [ERC7579ExecutorOperationExecuted(account, salt, mode, executionCalldata)](#ERC7579Executor-ERC7579ExecutorOperationExecuted-address-bytes32-bytes32-bytes-)
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [ERC7579ExecutorSelectorNotAuthorized(selector)](#ERC7579SelectorExecutor-ERC7579ExecutorSelectorNotAuthorized-bytes4-)
#### ERC7579Executor [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579SelectorExecutor-isAuthorized-address-bytes4-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">isAuthorized(address account, bytes4 selector) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-isAuthorized-address-bytes4-">#</a>
</div>
</div>
<div className="px-4">

</div>
</div>

<a id="ERC7579SelectorExecutor-selectors-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">selectors(address account) → bytes4[]</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-selectors-address-">#</a>
</div>
</div>
<div className="px-4">

Returns the set of authorized selectors for the specified account.

<Callout type="warn">
This operation copies the entire selectors set to memory, which
can be expensive or may result in unbounded computation.
</Callout>

</div>
</div>

<a id="ERC7579SelectorExecutor-onInstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onInstall(bytes initData)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-onInstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Sets up the module's initial configuration when installed by an account.
The initData should be encoded as: `abi.encode(bytes4[] selectors)`

</div>
</div>

<a id="ERC7579SelectorExecutor-onUninstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onUninstall(bytes)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-onUninstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

Cleans up module's configuration when uninstalled from an account.
Clears all selectors.

<Callout type="warn">
This function has unbounded gas costs and may become uncallable if the set grows too large.
See [`EnumerableSetExtended.clear`](./utils#EnumerableSetExtended-clear-struct-EnumerableSetExtended-Bytes32x2Set-).
</Callout>

</div>
</div>

<a id="ERC7579SelectorExecutor-addSelectors-bytes4---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">addSelectors(bytes4[] newSelectors)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-addSelectors-bytes4---">#</a>
</div>
</div>
<div className="px-4">

Adds `selectors` to the set for the calling account

</div>
</div>

<a id="ERC7579SelectorExecutor-removeSelectors-bytes4---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">removeSelectors(bytes4[] oldSelectors)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-removeSelectors-bytes4---">#</a>
</div>
</div>
<div className="px-4">

Removes a selector from the set for the calling account

</div>
</div>

<a id="ERC7579SelectorExecutor-_addSelectors-address-bytes4---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_addSelectors(address account, bytes4[] newSelectors)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-_addSelectors-address-bytes4---">#</a>
</div>
</div>
<div className="px-4">

Internal version of [`ERC7579SelectorExecutor.addSelectors`](#ERC7579SelectorExecutor-addSelectors-bytes4---) that takes an `account` as argument

</div>
</div>

<a id="ERC7579SelectorExecutor-_removeSelectors-address-bytes4---"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_removeSelectors(address account, bytes4[] oldSelectors)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-_removeSelectors-address-bytes4---">#</a>
</div>
</div>
<div className="px-4">

Internal version of [`ERC7579SelectorExecutor.removeSelectors`](#ERC7579SelectorExecutor-removeSelectors-bytes4---) that takes an `account` as argument

</div>
</div>

<a id="ERC7579SelectorExecutor-_validateExecution-address-bytes32-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validateExecution(address account, bytes32, bytes32, bytes data) → bytes</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-_validateExecution-address-bytes32-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

See [`ERC7579Executor._validateExecution`](#ERC7579Executor-_validateExecution-address-bytes32-bytes32-bytes-).
Validates that the selector (first 4 bytes of the actual callData) is authorized before execution.

</div>
</div>

<a id="ERC7579SelectorExecutor-ERC7579ExecutorSelectorAuthorized-address-bytes4-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorSelectorAuthorized(address indexed account, bytes4 selector)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-ERC7579ExecutorSelectorAuthorized-address-bytes4-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a selector is added to the set

</div>
</div>
<a id="ERC7579SelectorExecutor-ERC7579ExecutorSelectorRemoved-address-bytes4-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorSelectorRemoved(address indexed account, bytes4 selector)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-ERC7579ExecutorSelectorRemoved-address-bytes4-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a selector is removed from the set

</div>
</div>

<a id="ERC7579SelectorExecutor-ERC7579ExecutorSelectorNotAuthorized-bytes4-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579ExecutorSelectorNotAuthorized(bytes4 selector)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579SelectorExecutor-ERC7579ExecutorSelectorNotAuthorized-bytes4-">#</a>
</div>
</div>
<div className="px-4">

Error thrown when attempting to execute a non-authorized selector

</div>
</div>

<a id="ERC7579Signature"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579Signature`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579Signature.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579Signature.sol";
```

Implementation of [`ERC7579Validator`](#ERC7579Validator) module using ERC-7913 signature verification.

This validator allows ERC-7579 accounts to integrate with address-less cryptographic keys
and account signatures through the ERC-7913 signature verification system. Each account
can store its own ERC-7913 formatted signer (a concatenation of a verifier address and a
key: `verifier || key`).

This enables accounts to use signature schemes without requiring each key to have its own
Ethereum address.A smart account with this module installed can keep an emergency key as a
backup.

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [signer(account)](#ERC7579Signature-signer-address-)
- [onInstall(data)](#ERC7579Signature-onInstall-bytes-)
- [onUninstall()](#ERC7579Signature-onUninstall-bytes-)
- [setSigner(signer_)](#ERC7579Signature-setSigner-bytes-)
- [_setSigner(account, signer_)](#ERC7579Signature-_setSigner-address-bytes-)
- [_rawERC7579Validation(account, hash, signature)](#ERC7579Signature-_rawERC7579Validation-address-bytes32-bytes-)
#### ERC7579Validator [!toc]
- [isModuleType(moduleTypeId)](#ERC7579Validator-isModuleType-uint256-)
- [validateUserOp(userOp, userOpHash)](#ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-)
- [isValidSignatureWithSender(, hash, signature)](#ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-)
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [ERC7579SignatureSignerSet(account, signer)](#ERC7579Signature-ERC7579SignatureSignerSet-address-bytes-)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [ERC7579SignatureInvalidSignerLength()](#ERC7579Signature-ERC7579SignatureInvalidSignerLength--)
#### ERC7579Validator [!toc]
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
</div>
</div>

<a id="ERC7579Signature-signer-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">signer(address account) → bytes</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Signature-signer-address-">#</a>
</div>
</div>
<div className="px-4">

Return the ERC-7913 signer (i.e. `verifier || key`).

</div>
</div>

<a id="ERC7579Signature-onInstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onInstall(bytes data)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Signature-onInstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

See `IERC7579Module-onInstall`.

<Callout>
An account can only call onInstall once. If called directly by the account,
the signer will be set to the provided data. Future installations will behave as a no-op.
</Callout>

</div>
</div>

<a id="ERC7579Signature-onUninstall-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onUninstall(bytes)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Signature-onUninstall-bytes-">#</a>
</div>
</div>
<div className="px-4">

See `IERC7579Module-onUninstall`.

<Callout type="warn">
The signer's key will be removed if the account calls this function, potentially
making the account unusable. As an account operator, make sure to uninstall to a predefined path
in your account that properly handles side effects of uninstallation.  See `AccountERC7579-uninstallModule`.
</Callout>

</div>
</div>

<a id="ERC7579Signature-setSigner-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">setSigner(bytes signer_)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Signature-setSigner-bytes-">#</a>
</div>
</div>
<div className="px-4">

Sets the ERC-7913 signer (i.e. `verifier || key`) for the calling account.

</div>
</div>

<a id="ERC7579Signature-_setSigner-address-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_setSigner(address account, bytes signer_)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Signature-_setSigner-address-bytes-">#</a>
</div>
</div>
<div className="px-4">

Internal version of [`ERC7579Signature.setSigner`](#ERC7579Signature-setSigner-bytes-) that takes an `account` as argument without validating `signer_`.

</div>
</div>

<a id="ERC7579Signature-_rawERC7579Validation-address-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_rawERC7579Validation(address account, bytes32 hash, bytes signature) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Signature-_rawERC7579Validation-address-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

See [`ERC7579Validator._rawERC7579Validation`](#ERC7579Validator-_rawERC7579Validation-address-bytes32-bytes-).

Validates a `signature` using ERC-7913 verification.

This base implementation ignores the `sender` parameter and validates using
the account's stored signer. Derived contracts can override this to implement
custom validation logic based on the sender.

</div>
</div>

<a id="ERC7579Signature-ERC7579SignatureSignerSet-address-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579SignatureSignerSet(address indexed account, bytes signer)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="ERC7579Signature-ERC7579SignatureSignerSet-address-bytes-">#</a>
</div>
</div>

<div className="px-4">

Emitted when the signer is set.

</div>
</div>

<a id="ERC7579Signature-ERC7579SignatureInvalidSignerLength--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">ERC7579SignatureInvalidSignerLength()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="ERC7579Signature-ERC7579SignatureInvalidSignerLength--">#</a>
</div>
</div>
<div className="px-4">

Thrown when the signer length is less than 20 bytes.

</div>
</div>

<a id="ERC7579Validator"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `ERC7579Validator`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/modules/ERC7579Validator.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/modules/ERC7579Validator.sol";
```

Abstract validator module for ERC-7579 accounts.

This contract provides the base implementation for signature validation in ERC-7579 accounts.
Developers must implement the onInstall, onUninstall, and [`ERC7579Multisig._rawERC7579Validation`](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-)
functions in derived contracts to define the specific signature validation logic.

Example usage:

```solidity
contract MyValidatorModule is ERC7579Validator {
    function onInstall(bytes calldata data) public {
        // Install logic here
    }

    function onUninstall(bytes calldata data) public {
        // Uninstall logic here
    }

    function _rawERC7579Validation(
        address account,
        bytes32 hash,
        bytes calldata signature
    ) internal view override returns (bool) {
        // Signature validation logic here
    }
}
```

Developers can restrict other operations by using the internal [`ERC7579Multisig._rawERC7579Validation`](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-).
Example usage:

```solidity
function execute(
    address account,
    Mode mode,
    bytes calldata executionCalldata,
    bytes32 salt,
    bytes calldata signature
) public virtual {
    require(_rawERC7579Validation(account, hash, signature));
    // ... rest of execute logic
}
```

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [isModuleType(moduleTypeId)](#ERC7579Validator-isModuleType-uint256-)
- [validateUserOp(userOp, userOpHash)](#ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-)
- [isValidSignatureWithSender(, hash, signature)](#ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-)
- [_rawERC7579Validation(account, hash, signature)](#ERC7579Validator-_rawERC7579Validation-address-bytes32-bytes-)
#### IERC7579Validator [!toc]
#### IERC7579Module [!toc]
- [onInstall(data)](#IERC7579Module-onInstall-bytes-)
- [onUninstall(data)](#IERC7579Module-onUninstall-bytes-)
</div>
</div>

<a id="ERC7579Validator-isModuleType-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">isModuleType(uint256 moduleTypeId) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Validator-isModuleType-uint256-">#</a>
</div>
</div>
<div className="px-4">

Returns boolean value if module is a certain type

</div>
</div>

<a id="ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">validateUserOp(struct PackedUserOperation userOp, bytes32 userOpHash) → uint256</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Validator-validateUserOp-struct-PackedUserOperation-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Validates a UserOperation

</div>
</div>

<a id="ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">isValidSignatureWithSender(address, bytes32 hash, bytes signature) → bytes4</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="ERC7579Validator-isValidSignatureWithSender-address-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

See `IERC7579Validator-isValidSignatureWithSender`.

Ignores the `sender` parameter and validates using [`ERC7579Multisig._rawERC7579Validation`](#ERC7579Multisig-_rawERC7579Validation-address-bytes32-bytes-).
Consider overriding this function to implement custom validation logic
based on the original sender.

</div>
</div>

<a id="ERC7579Validator-_rawERC7579Validation-address-bytes32-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_rawERC7579Validation(address account, bytes32 hash, bytes signature) → bool</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="ERC7579Validator-_rawERC7579Validation-address-bytes32-bytes-">#</a>
</div>
</div>
<div className="px-4">

Validation algorithm.

<Callout type="warn">
Validation is a critical security function. Implementations must carefully
handle cryptographic verification to prevent unauthorized access.
</Callout>

</div>
</div>

<a id="PaymasterCore"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `PaymasterCore`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/paymaster/PaymasterCore.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/paymaster/PaymasterCore.sol";
```

A simple ERC4337 paymaster implementation. This base implementation only includes the minimal logic to validate
and pay for user operations.

Developers must implement the [`PaymasterCore._validatePaymasterUserOp`](#PaymasterCore-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-) function to define the paymaster's validation
and payment logic. The `context` parameter is used to pass data between the validation and execution phases.

The paymaster includes support to call the `IEntryPointStake` interface to manage the paymaster's deposits and stakes
through the internal functions [`PaymasterCore.deposit`](#PaymasterCore-deposit--), [`PaymasterCore.withdraw`](#PaymasterCore-withdraw-address-payable-uint256-), [`PaymasterCore.addStake`](#PaymasterCore-addStake-uint32-), [`PaymasterCore.unlockStake`](#PaymasterCore-unlockStake--) and [`PaymasterCore.withdrawStake`](#PaymasterCore-withdrawStake-address-payable-).

* Deposits are used to pay for user operations.
* Stakes are used to guarantee the paymaster's reputation and obtain more flexibility in accessing storage.

<Callout>
See [Paymaster's unstaked reputation rules](https://eips.ethereum.org/EIPS/eip-7562#unstaked-paymasters-reputation-rules)
 for more details on the paymaster's storage access limitations.
</Callout>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Modifiers</h3>
<div className="font-mono">
- [onlyEntryPoint()](#PaymasterCore-onlyEntryPoint--)
- [onlyWithdrawer()](#PaymasterCore-onlyWithdrawer--)
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [entryPoint()](#PaymasterCore-entryPoint--)
- [validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [postOp(mode, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [_validatePaymasterUserOp(userOp, userOpHash, requiredPreFund)](#PaymasterCore-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [_postOp(, , , )](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [deposit()](#PaymasterCore-deposit--)
- [withdraw(to, value)](#PaymasterCore-withdraw-address-payable-uint256-)
- [addStake(unstakeDelaySec)](#PaymasterCore-addStake-uint32-)
- [unlockStake()](#PaymasterCore-unlockStake--)
- [withdrawStake(to)](#PaymasterCore-withdrawStake-address-payable-)
- [_checkEntryPoint()](#PaymasterCore-_checkEntryPoint--)
- [_authorizeWithdraw()](#PaymasterCore-_authorizeWithdraw--)
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [PaymasterUnauthorized(sender)](#PaymasterCore-PaymasterUnauthorized-address-)
#### IPaymaster [!toc]
</div>
</div>

<a id="PaymasterCore-onlyEntryPoint--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onlyEntryPoint()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterCore-onlyEntryPoint--">#</a>
</div>
</div>

<div className="px-4">

Revert if the caller is not the entry point.

</div>
</div>

<a id="PaymasterCore-onlyWithdrawer--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">onlyWithdrawer()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterCore-onlyWithdrawer--">#</a>
</div>
</div>

<div className="px-4">

</div>
</div>

<a id="PaymasterCore-entryPoint--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">entryPoint() → contract IEntryPoint</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-entryPoint--">#</a>
</div>
</div>
<div className="px-4">

Canonical entry point for the account that forwards and validates user operations.

</div>
</div>

<a id="PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">validatePaymasterUserOp(struct PackedUserOperation userOp, bytes32 userOpHash, uint256 maxCost) → bytes context, uint256 validationData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-">#</a>
</div>
</div>
<div className="px-4">

Validates whether the paymaster is willing to pay for the user operation. See
`IAccount-validateUserOp` for additional information on the return value.

<Callout>
Bundlers will reject this method if it modifies the state, unless it's whitelisted.
</Callout>

</div>
</div>

<a id="PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">postOp(enum IPaymaster.PostOpMode mode, bytes context, uint256 actualGasCost, uint256 actualUserOpFeePerGas)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-">#</a>
</div>
</div>
<div className="px-4">

Verifies the sender is the entrypoint.

</div>
</div>

<a id="PaymasterCore-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validatePaymasterUserOp(struct PackedUserOperation userOp, bytes32 userOpHash, uint256 requiredPreFund) → bytes context, uint256 validationData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterCore-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-">#</a>
</div>
</div>
<div className="px-4">

Internal validation of whether the paymaster is willing to pay for the user operation.
Returns the context to be passed to postOp and the validation data.

The `requiredPreFund` is the amount the paymaster has to pay (in native tokens). It's calculated
as `requiredGas * userOp.maxFeePerGas`, where `required` gas can be calculated from the user operation
as `verificationGasLimit + callGasLimit + paymasterVerificationGasLimit + paymasterPostOpGasLimit + preVerificationGas`

</div>
</div>

<a id="PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_postOp(enum IPaymaster.PostOpMode, bytes, uint256, uint256)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-">#</a>
</div>
</div>
<div className="px-4">

Handles post user operation execution logic. The caller must be the entry point.

It receives the `context` returned by `_validatePaymasterUserOp`. Function is not called if no context
is returned by [`PaymasterCore.validatePaymasterUserOp`](#PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-).

<Callout>
The `actualUserOpFeePerGas` is not `tx.gasprice`. A user operation can be bundled with other transactions
making the gas price of the user operation to differ.
</Callout>

</div>
</div>

<a id="PaymasterCore-deposit--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">deposit()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-deposit--">#</a>
</div>
</div>
<div className="px-4">

Calls `IEntryPointStake-depositTo`.

</div>
</div>

<a id="PaymasterCore-withdraw-address-payable-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">withdraw(address payable to, uint256 value)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-withdraw-address-payable-uint256-">#</a>
</div>
</div>
<div className="px-4">

Calls `IEntryPointStake-withdrawTo`.

</div>
</div>

<a id="PaymasterCore-addStake-uint32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">addStake(uint32 unstakeDelaySec)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-addStake-uint32-">#</a>
</div>
</div>
<div className="px-4">

Calls `IEntryPointStake-addStake`.

</div>
</div>

<a id="PaymasterCore-unlockStake--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">unlockStake()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-unlockStake--">#</a>
</div>
</div>
<div className="px-4">

Calls `IEntryPointStake-unlockStake`.

</div>
</div>

<a id="PaymasterCore-withdrawStake-address-payable-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">withdrawStake(address payable to)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterCore-withdrawStake-address-payable-">#</a>
</div>
</div>
<div className="px-4">

Calls `IEntryPointStake-withdrawStake`.

</div>
</div>

<a id="PaymasterCore-_checkEntryPoint--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_checkEntryPoint()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterCore-_checkEntryPoint--">#</a>
</div>
</div>
<div className="px-4">

Ensures the caller is the `entrypoint`.

</div>
</div>

<a id="PaymasterCore-_authorizeWithdraw--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_authorizeWithdraw()</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterCore-_authorizeWithdraw--">#</a>
</div>
</div>
<div className="px-4">

Checks whether `msg.sender` withdraw funds stake or deposit from the entrypoint on paymaster's behalf.

Use of an [access control](https://docs.openzeppelin.com/contracts/5.x/access-control)
modifier such as `Ownable-onlyOwner` is recommended.

```solidity
function _authorizeUpgrade() internal onlyOwner {}
```

</div>
</div>

<a id="PaymasterCore-PaymasterUnauthorized-address-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">PaymasterUnauthorized(address sender)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="PaymasterCore-PaymasterUnauthorized-address-">#</a>
</div>
</div>
<div className="px-4">

Unauthorized call to the paymaster.

</div>
</div>

<a id="PaymasterERC20"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `PaymasterERC20`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/paymaster/PaymasterERC20.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/paymaster/PaymasterERC20.sol";
```

Extension of [`PaymasterCore`](#PaymasterCore) that enables users to pay gas with ERC-20 tokens.

To enable this feature, developers must implement the [`PaymasterERC20._fetchDetails`](#PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-) function:

```solidity
function _fetchDetails(
    PackedUserOperation calldata userOp,
    bytes32 userOpHash
) internal view override returns (uint256 validationData, IERC20 token, uint256 tokenPrice) {
    // Implement logic to fetch the token, and token price from the userOp
}
```

The contract follows a pre-charge and refund model:
1. During validation, it pre-charges the maximum possible gas cost
2. After execution, it refunds any unused gas back to the user

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [_validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterERC20-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [_prefund(userOp, , token, tokenPrice, prefunder_, maxCost)](#PaymasterERC20-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-)
- [_postOp(, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterERC20-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [_refund(token, tokenPrice, actualGasCost, actualUserOpFeePerGas, prefunder, prefundAmount, )](#PaymasterERC20-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-)
- [_fetchDetails(userOp, userOpHash)](#PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-)
- [_postOpCost()](#PaymasterERC20-_postOpCost--)
- [_tokenPriceDenominator()](#PaymasterERC20-_tokenPriceDenominator--)
- [_erc20Cost(cost, feePerGas, tokenPrice)](#PaymasterERC20-_erc20Cost-uint256-uint256-uint256-)
- [withdrawTokens(token, recipient, amount)](#PaymasterERC20-withdrawTokens-contract-IERC20-address-uint256-)
#### PaymasterCore [!toc]
- [entryPoint()](#PaymasterCore-entryPoint--)
- [validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [postOp(mode, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [deposit()](#PaymasterCore-deposit--)
- [withdraw(to, value)](#PaymasterCore-withdraw-address-payable-uint256-)
- [addStake(unstakeDelaySec)](#PaymasterCore-addStake-uint32-)
- [unlockStake()](#PaymasterCore-unlockStake--)
- [withdrawStake(to)](#PaymasterCore-withdrawStake-address-payable-)
- [_checkEntryPoint()](#PaymasterCore-_checkEntryPoint--)
- [_authorizeWithdraw()](#PaymasterCore-_authorizeWithdraw--)
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [UserOperationSponsored(userOpHash, token, tokenAmount, tokenPrice)](#PaymasterERC20-UserOperationSponsored-bytes32-address-uint256-uint256-)
#### PaymasterCore [!toc]
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
- [PaymasterERC20FailedRefund(token, prefundAmount, actualAmount, prefundContext)](#PaymasterERC20-PaymasterERC20FailedRefund-contract-IERC20-uint256-uint256-bytes-)
#### PaymasterCore [!toc]
- [PaymasterUnauthorized(sender)](#PaymasterCore-PaymasterUnauthorized-address-)
#### IPaymaster [!toc]
</div>
</div>

<a id="PaymasterERC20-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validatePaymasterUserOp(struct PackedUserOperation userOp, bytes32 userOpHash, uint256 maxCost) → bytes context, uint256 validationData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-">#</a>
</div>
</div>
<div className="px-4">

See [`PaymasterCore._validatePaymasterUserOp`](#PaymasterCore-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-).

Attempts to retrieve the `token` and `tokenPrice` from the user operation (see [`PaymasterERC20._fetchDetails`](#PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-))
and prefund the user operation using these values and the `maxCost` argument (see [`PaymasterERC20._prefund`](#PaymasterERC20-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-)).

Returns `abi.encodePacked(userOpHash, token, tokenPrice, prefundAmount, prefunder, prefundContext)` in
`context` if the prefund is successful. Otherwise, it returns empty bytes.

</div>
</div>

<a id="PaymasterERC20-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_prefund(struct PackedUserOperation userOp, bytes32, contract IERC20 token, uint256 tokenPrice, address prefunder_, uint256 maxCost) → bool prefunded, uint256 prefundAmount, address prefunder, bytes prefundContext</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-">#</a>
</div>
</div>
<div className="px-4">

Prefunds the `userOp` by charging the maximum possible gas cost (`maxCost`) in ERC-20 `token`.

The `token` and `tokenPrice` is obtained from the [`PaymasterERC20._fetchDetails`](#PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-) function and are funded by the `prefunder_`,
which is the user operation sender by default. The `prefundAmount` is calculated using [`PaymasterERC20._erc20Cost`](#PaymasterERC20-_erc20Cost-uint256-uint256-uint256-).

Returns a `prefundContext` that's passed to the [`PaymasterCore._postOp`](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-) function through its `context` return value.

<Callout>
Consider not reverting if the prefund fails when overriding this function. This is to avoid reverting
during the validation phase of the user operation, which may penalize the paymaster's reputation according
to ERC-7562 validation rules.
</Callout>

</div>
</div>

<a id="PaymasterERC20-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_postOp(enum IPaymaster.PostOpMode, bytes context, uint256 actualGasCost, uint256 actualUserOpFeePerGas)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-">#</a>
</div>
</div>
<div className="px-4">

Attempts to refund the user operation after execution. See [`PaymasterERC20._refund`](#PaymasterERC20-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-).

Reverts with [`PaymasterERC20.PaymasterERC20FailedRefund`](#PaymasterERC20-PaymasterERC20FailedRefund-contract-IERC20-uint256-uint256-bytes-) if the refund fails.

<Callout type="warn">
This function may revert after the user operation has been executed without
reverting the user operation itself. Consider implementing a mechanism to handle
this case gracefully.
</Callout>

</div>
</div>

<a id="PaymasterERC20-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_refund(contract IERC20 token, uint256 tokenPrice, uint256 actualGasCost, uint256 actualUserOpFeePerGas, address prefunder, uint256 prefundAmount, bytes) → bool refunded, uint256 actualAmount</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-">#</a>
</div>
</div>
<div className="px-4">

Refunds any unused gas back to the user (i.e. `prefundAmount - actualAmount`) in `token`.

The `actualAmount` is calculated using [`PaymasterERC20._erc20Cost`](#PaymasterERC20-_erc20Cost-uint256-uint256-uint256-) and the `actualGasCost`, `actualUserOpFeePerGas`, `prefundContext`
and the `tokenPrice` from the [`PaymasterCore._postOp`](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)'s context.

</div>
</div>

<a id="PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_fetchDetails(struct PackedUserOperation userOp, bytes32 userOpHash) → uint256 validationData, contract IERC20 token, uint256 tokenPrice</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-">#</a>
</div>
</div>
<div className="px-4">

Retrieves payment details for a user operation.

The values returned by this internal function are:

* `validationData`: ERC-4337 validation data, indicating success/failure and optional time validity (`validAfter`, `validUntil`).
* `token`: Address of the ERC-20 token used for payment to the paymaster.
* `tokenPrice`: Price of the token in native currency, scaled by `_tokenPriceDenominator()`.

==== Calculating the token price

Given gas fees are paid in native currency, developers can use the `ERC20 price unit / native price unit` ratio to
calculate the price of an ERC20 token price in native currency. However, the token may have a different number of decimals
than the native currency. For a a generalized formula considering prices in USD and decimals, consider using:

`(<ERC-20 token price in $> / 10**<ERC-20 decimals>) / (<Native token price in $> / 1e18) * _tokenPriceDenominator()`

For example, suppose token is USDC ($1 with 6 decimals) and native currency is ETH (assuming $2524.86 with 18 decimals),
then each unit (1e-6) of USDC is worth `(1 / 1e6) / ((252486 / 1e2) / 1e18) = 396061563.8094785` wei. The `_tokenPriceDenominator()`
ensures precision by avoiding fractional value loss. (i.e. the 0.8094785 part).

</div>
</div>

<a id="PaymasterERC20-_postOpCost--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_postOpCost() → uint256</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_postOpCost--">#</a>
</div>
</div>
<div className="px-4">

Over-estimates the cost of the post-operation logic.

</div>
</div>

<a id="PaymasterERC20-_tokenPriceDenominator--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_tokenPriceDenominator() → uint256</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_tokenPriceDenominator--">#</a>
</div>
</div>
<div className="px-4">

Denominator used for interpreting the `tokenPrice` returned by [`PaymasterERC20._fetchDetails`](#PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-) as "fixed point" in [`PaymasterERC20._erc20Cost`](#PaymasterERC20-_erc20Cost-uint256-uint256-uint256-).

</div>
</div>

<a id="PaymasterERC20-_erc20Cost-uint256-uint256-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_erc20Cost(uint256 cost, uint256 feePerGas, uint256 tokenPrice) → uint256</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20-_erc20Cost-uint256-uint256-uint256-">#</a>
</div>
</div>
<div className="px-4">

Calculates the cost of the user operation in ERC-20 tokens.

</div>
</div>

<a id="PaymasterERC20-withdrawTokens-contract-IERC20-address-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">withdrawTokens(contract IERC20 token, address recipient, uint256 amount)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterERC20-withdrawTokens-contract-IERC20-address-uint256-">#</a>
</div>
</div>
<div className="px-4">

Public function that allows the withdrawer to extract ERC-20 tokens resulting from gas payments.

</div>
</div>

<a id="PaymasterERC20-UserOperationSponsored-bytes32-address-uint256-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">UserOperationSponsored(bytes32 indexed userOpHash, address indexed token, uint256 tokenAmount, uint256 tokenPrice)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="PaymasterERC20-UserOperationSponsored-bytes32-address-uint256-uint256-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a user operation identified by `userOpHash` is sponsored by this paymaster
using the specified ERC-20 `token`. The `tokenAmount` is the amount charged for the operation,
and `tokenPrice` is the price of the token in native currency (e.g., ETH).

</div>
</div>

<a id="PaymasterERC20-PaymasterERC20FailedRefund-contract-IERC20-uint256-uint256-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">PaymasterERC20FailedRefund(contract IERC20 token, uint256 prefundAmount, uint256 actualAmount, bytes prefundContext)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">error</p>
<a className="peer" data-card href="PaymasterERC20-PaymasterERC20FailedRefund-contract-IERC20-uint256-uint256-bytes-">#</a>
</div>
</div>
<div className="px-4">

Throws when the paymaster fails to refund the difference between the `prefundAmount`
and the `actualAmount` of `token`.

</div>
</div>

<a id="PaymasterERC20Guarantor"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `PaymasterERC20Guarantor`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/paymaster/PaymasterERC20Guarantor.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/paymaster/PaymasterERC20Guarantor.sol";
```

Extension of [`PaymasterERC20`](#PaymasterERC20) that enables third parties to guarantee user operations.

This contract allows a guarantor to pre-fund user operations on behalf of users. The guarantor
pays the maximum possible gas cost upfront, and after execution:
1. If the user repays the guarantor, the guarantor gets their funds back
2. If the user fails to repay, the guarantor absorbs the cost

A common use case is for guarantors to pay for the operations of users claiming airdrops. In this scenario:

* The guarantor pays the gas fees upfront
* The user claims their airdrop tokens
* The user repays the guarantor from the claimed tokens
* If the user fails to repay, the guarantor absorbs the cost

The guarantor is identified through the [`PaymasterERC20Guarantor._fetchGuarantor`](#PaymasterERC20Guarantor-_fetchGuarantor-struct-PackedUserOperation-) function, which must be implemented
by developers to determine who can guarantee operations. This allows for flexible guarantor selection
logic based on the specific requirements of the application.

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [_prefund(userOp, userOpHash, token, tokenPrice, prefunder_, maxCost)](#PaymasterERC20Guarantor-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-)
- [_refund(token, tokenPrice, actualGasCost, actualUserOpFeePerGas, prefunder, prefundAmount, prefundContext)](#PaymasterERC20Guarantor-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-)
- [_fetchGuarantor(userOp)](#PaymasterERC20Guarantor-_fetchGuarantor-struct-PackedUserOperation-)
- [_guaranteedPostOpCost()](#PaymasterERC20Guarantor-_guaranteedPostOpCost--)
#### PaymasterERC20 [!toc]
- [_validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterERC20-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [_postOp(, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterERC20-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [_fetchDetails(userOp, userOpHash)](#PaymasterERC20-_fetchDetails-struct-PackedUserOperation-bytes32-)
- [_postOpCost()](#PaymasterERC20-_postOpCost--)
- [_tokenPriceDenominator()](#PaymasterERC20-_tokenPriceDenominator--)
- [_erc20Cost(cost, feePerGas, tokenPrice)](#PaymasterERC20-_erc20Cost-uint256-uint256-uint256-)
- [withdrawTokens(token, recipient, amount)](#PaymasterERC20-withdrawTokens-contract-IERC20-address-uint256-)
#### PaymasterCore [!toc]
- [entryPoint()](#PaymasterCore-entryPoint--)
- [validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [postOp(mode, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [deposit()](#PaymasterCore-deposit--)
- [withdraw(to, value)](#PaymasterCore-withdraw-address-payable-uint256-)
- [addStake(unstakeDelaySec)](#PaymasterCore-addStake-uint32-)
- [unlockStake()](#PaymasterCore-unlockStake--)
- [withdrawStake(to)](#PaymasterCore-withdrawStake-address-payable-)
- [_checkEntryPoint()](#PaymasterCore-_checkEntryPoint--)
- [_authorizeWithdraw()](#PaymasterCore-_authorizeWithdraw--)
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [UserOperationGuaranteed(userOpHash, guarantor, prefundAmount)](#PaymasterERC20Guarantor-UserOperationGuaranteed-bytes32-address-uint256-)
#### PaymasterERC20 [!toc]
- [UserOperationSponsored(userOpHash, token, tokenAmount, tokenPrice)](#PaymasterERC20-UserOperationSponsored-bytes32-address-uint256-uint256-)
#### PaymasterCore [!toc]
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
#### PaymasterERC20 [!toc]
- [PaymasterERC20FailedRefund(token, prefundAmount, actualAmount, prefundContext)](#PaymasterERC20-PaymasterERC20FailedRefund-contract-IERC20-uint256-uint256-bytes-)
#### PaymasterCore [!toc]
- [PaymasterUnauthorized(sender)](#PaymasterCore-PaymasterUnauthorized-address-)
#### IPaymaster [!toc]
</div>
</div>

<a id="PaymasterERC20Guarantor-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_prefund(struct PackedUserOperation userOp, bytes32 userOpHash, contract IERC20 token, uint256 tokenPrice, address prefunder_, uint256 maxCost) → bool prefunded, uint256 prefundAmount, address prefunder, bytes prefundContext</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20Guarantor-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-">#</a>
</div>
</div>
<div className="px-4">

Prefunds the user operation using either the guarantor or the default prefunder.
See [`PaymasterERC20._prefund`](#PaymasterERC20-_prefund-struct-PackedUserOperation-bytes32-contract-IERC20-uint256-address-uint256-).

Returns `abi.encodePacked(..., userOp.sender)` in `prefundContext` to allow
the refund process to identify the user operation sender.

</div>
</div>

<a id="PaymasterERC20Guarantor-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_refund(contract IERC20 token, uint256 tokenPrice, uint256 actualGasCost, uint256 actualUserOpFeePerGas, address prefunder, uint256 prefundAmount, bytes prefundContext) → bool refunded, uint256 actualAmount</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20Guarantor-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-">#</a>
</div>
</div>
<div className="px-4">

Handles the refund process for guaranteed operations.

If the operation was guaranteed, it attempts to get repayment from the user first and then refunds the guarantor.
Otherwise, fallback to [`PaymasterERC20._refund`](#PaymasterERC20-_refund-contract-IERC20-uint256-uint256-uint256-address-uint256-bytes-).

<Callout>
For guaranteed user operations where the user paid the `actualGasCost` back, this function
doesn't call `super._refund`. Consider whether there are side effects in the parent contract that need to be executed.
</Callout>

</div>
</div>

<a id="PaymasterERC20Guarantor-_fetchGuarantor-struct-PackedUserOperation-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_fetchGuarantor(struct PackedUserOperation userOp) → address guarantor</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20Guarantor-_fetchGuarantor-struct-PackedUserOperation-">#</a>
</div>
</div>
<div className="px-4">

Fetches the guarantor address and validation data from the user operation.

<Callout>
Return `address(0)` to disable the guarantor feature. If supported, ensure
explicit consent (e.g., signature verification) to prevent unauthorized use.
</Callout>

</div>
</div>

<a id="PaymasterERC20Guarantor-_guaranteedPostOpCost--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_guaranteedPostOpCost() → uint256</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC20Guarantor-_guaranteedPostOpCost--">#</a>
</div>
</div>
<div className="px-4">

Over-estimates the cost of the post-operation logic. Added on top of guaranteed userOps post-operation cost.

</div>
</div>

<a id="PaymasterERC20Guarantor-UserOperationGuaranteed-bytes32-address-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">UserOperationGuaranteed(bytes32 indexed userOpHash, address indexed guarantor, uint256 prefundAmount)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="PaymasterERC20Guarantor-UserOperationGuaranteed-bytes32-address-uint256-">#</a>
</div>
</div>

<div className="px-4">

Emitted when a user operation identified by `userOpHash` is guaranteed by a `guarantor` for `prefundAmount`.

</div>
</div>

<a id="PaymasterERC721Owner"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `PaymasterERC721Owner`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/paymaster/PaymasterERC721Owner.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/paymaster/PaymasterERC721Owner.sol";
```

Extension of [`PaymasterCore`](#PaymasterCore) that supports account based on ownership of an ERC-721 token.

This paymaster will sponsor user operations if the user has at least 1 token of the token specified
during construction (or via [`PaymasterERC721Owner._setToken`](#PaymasterERC721Owner-_setToken-contract-IERC721-)).

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [constructor(token_)](#PaymasterERC721Owner-constructor-contract-IERC721-)
- [token()](#PaymasterERC721Owner-token--)
- [_setToken(token_)](#PaymasterERC721Owner-_setToken-contract-IERC721-)
- [_validatePaymasterUserOp(userOp, , )](#PaymasterERC721Owner-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
#### PaymasterCore [!toc]
- [entryPoint()](#PaymasterCore-entryPoint--)
- [validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [postOp(mode, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [_postOp(, , , )](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [deposit()](#PaymasterCore-deposit--)
- [withdraw(to, value)](#PaymasterCore-withdraw-address-payable-uint256-)
- [addStake(unstakeDelaySec)](#PaymasterCore-addStake-uint32-)
- [unlockStake()](#PaymasterCore-unlockStake--)
- [withdrawStake(to)](#PaymasterCore-withdrawStake-address-payable-)
- [_checkEntryPoint()](#PaymasterCore-_checkEntryPoint--)
- [_authorizeWithdraw()](#PaymasterCore-_authorizeWithdraw--)
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
- [PaymasterERC721OwnerTokenSet(token)](#PaymasterERC721Owner-PaymasterERC721OwnerTokenSet-contract-IERC721-)
#### PaymasterCore [!toc]
#### IPaymaster [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
#### PaymasterCore [!toc]
- [PaymasterUnauthorized(sender)](#PaymasterCore-PaymasterUnauthorized-address-)
#### IPaymaster [!toc]
</div>
</div>

<a id="PaymasterERC721Owner-constructor-contract-IERC721-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">constructor(contract IERC721 token_)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC721Owner-constructor-contract-IERC721-">#</a>
</div>
</div>
<div className="px-4">

</div>
</div>

<a id="PaymasterERC721Owner-token--"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">token() → contract IERC721</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">public</p>
<a className="peer" data-card href="PaymasterERC721Owner-token--">#</a>
</div>
</div>
<div className="px-4">

ERC-721 token used to validate the user operation.

</div>
</div>

<a id="PaymasterERC721Owner-_setToken-contract-IERC721-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_setToken(contract IERC721 token_)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC721Owner-_setToken-contract-IERC721-">#</a>
</div>
</div>
<div className="px-4">

Sets the ERC-721 token used to validate the user operation.

</div>
</div>

<a id="PaymasterERC721Owner-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validatePaymasterUserOp(struct PackedUserOperation userOp, bytes32, uint256) → bytes context, uint256 validationData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterERC721Owner-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-">#</a>
</div>
</div>
<div className="px-4">

Internal validation of whether the paymaster is willing to pay for the user operation.
Returns the context to be passed to postOp and the validation data.

<Callout>
The default `context` is `bytes(0)`. Developers that add a context when overriding this function MUST
also override [`PaymasterCore._postOp`](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-) to process the context passed along.
</Callout>

</div>
</div>

<a id="PaymasterERC721Owner-PaymasterERC721OwnerTokenSet-contract-IERC721-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">PaymasterERC721OwnerTokenSet(contract IERC721 token)</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">event</p>
<a className="peer" data-card href="PaymasterERC721Owner-PaymasterERC721OwnerTokenSet-contract-IERC721-">#</a>
</div>
</div>

<div className="px-4">

Emitted when the paymaster token is set.

</div>
</div>

<a id="PaymasterSigner"></a>

<div style={{marginTop: "4em"}} className="w-full flex flex-row items-center justify-between">

## `PaymasterSigner`

<a target="_blank" style={{marginTop: "1.5em"}} href="https://github.com/OpenZeppelin/openzeppelin-community-contracts/blob/master/contracts/account/paymaster/PaymasterSigner.sol">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
</a>

</div>

```solidity
import "@openzeppelin/community-contracts/account/paymaster/PaymasterSigner.sol";
```

Extension of [`PaymasterCore`](#PaymasterCore) that adds signature validation. See `SignerECDSA`, `SignerP256` or `SignerRSA`.

Example of usage:

```solidity
contract MyPaymasterECDSASigner is PaymasterSigner, SignerECDSA {
    constructor(address signerAddr) EIP712("MyPaymasterECDSASigner", "1") SignerECDSA(signerAddr) {}
}
```

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Functions</h3>
<div className="font-mono">
- [_signableUserOpHash(userOp, validAfter, validUntil)](#PaymasterSigner-_signableUserOpHash-struct-PackedUserOperation-uint48-uint48-)
- [_validatePaymasterUserOp(userOp, , )](#PaymasterSigner-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [_decodePaymasterUserOp(userOp)](#PaymasterSigner-_decodePaymasterUserOp-struct-PackedUserOperation-)
#### PaymasterCore [!toc]
- [entryPoint()](#PaymasterCore-entryPoint--)
- [validatePaymasterUserOp(userOp, userOpHash, maxCost)](#PaymasterCore-validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-)
- [postOp(mode, context, actualGasCost, actualUserOpFeePerGas)](#PaymasterCore-postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [_postOp(, , , )](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-)
- [deposit()](#PaymasterCore-deposit--)
- [withdraw(to, value)](#PaymasterCore-withdraw-address-payable-uint256-)
- [addStake(unstakeDelaySec)](#PaymasterCore-addStake-uint32-)
- [unlockStake()](#PaymasterCore-unlockStake--)
- [withdrawStake(to)](#PaymasterCore-withdrawStake-address-payable-)
- [_checkEntryPoint()](#PaymasterCore-_checkEntryPoint--)
- [_authorizeWithdraw()](#PaymasterCore-_authorizeWithdraw--)
#### IPaymaster [!toc]
#### EIP712 [!toc]
- [_domainSeparatorV4()](#EIP712-_domainSeparatorV4--)
- [_hashTypedDataV4(structHash)](#EIP712-_hashTypedDataV4-bytes32-)
- [eip712Domain()](#EIP712-eip712Domain--)
- [_EIP712Name()](#EIP712-_EIP712Name--)
- [_EIP712Version()](#EIP712-_EIP712Version--)
#### IERC5267 [!toc]
#### AbstractSigner [!toc]
- [_rawSignatureValidation(hash, signature)](#AbstractSigner-_rawSignatureValidation-bytes32-bytes-)
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Events</h3>
<div className="font-mono">
#### PaymasterCore [!toc]
#### IPaymaster [!toc]
#### EIP712 [!toc]
#### IERC5267 [!toc]
- [EIP712DomainChanged()](#IERC5267-EIP712DomainChanged--)
#### AbstractSigner [!toc]
</div>
</div>

<div className="bg-secondary p-4 rounded-md mb-6">
<h3 style={{ marginTop: "0"}}>Errors</h3>
<div className="font-mono">
#### PaymasterCore [!toc]
- [PaymasterUnauthorized(sender)](#PaymasterCore-PaymasterUnauthorized-address-)
#### IPaymaster [!toc]
#### EIP712 [!toc]
#### IERC5267 [!toc]
#### AbstractSigner [!toc]
</div>
</div>

<a id="PaymasterSigner-_signableUserOpHash-struct-PackedUserOperation-uint48-uint48-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_signableUserOpHash(struct PackedUserOperation userOp, uint48 validAfter, uint48 validUntil) → bytes32</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterSigner-_signableUserOpHash-struct-PackedUserOperation-uint48-uint48-">#</a>
</div>
</div>
<div className="px-4">

Virtual function that returns the signable hash for a user operations. Given the `userOpHash`
contains the `paymasterAndData` itself, it's not possible to sign that value directly. Instead,
this function must be used to provide a custom mechanism to authorize an user operation.

</div>
</div>

<a id="PaymasterSigner-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_validatePaymasterUserOp(struct PackedUserOperation userOp, bytes32, uint256) → bytes context, uint256 validationData</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterSigner-_validatePaymasterUserOp-struct-PackedUserOperation-bytes32-uint256-">#</a>
</div>
</div>
<div className="px-4">

Internal validation of whether the paymaster is willing to pay for the user operation.
Returns the context to be passed to postOp and the validation data.

<Callout>
The `context` returned is `bytes(0)`. Developers overriding this function MUST
override [`PaymasterCore._postOp`](#PaymasterCore-_postOp-enum-IPaymaster-PostOpMode-bytes-uint256-uint256-) to process the context passed along.
</Callout>

</div>
</div>

<a id="PaymasterSigner-_decodePaymasterUserOp-struct-PackedUserOperation-"></a>

<div className="border rounded-md mb-4">
<div className="bg-secondary flex w-full justify-between px-4">
<p className="font-bold text-sm font-mono">_decodePaymasterUserOp(struct PackedUserOperation userOp) → uint48 validAfter, uint48 validUntil, bytes signature</p>
<div className="flex flex-row items-center gap-2">
<p className="font-light text-sm">internal</p>
<a className="peer" data-card href="PaymasterSigner-_decodePaymasterUserOp-struct-PackedUserOperation-">#</a>
</div>
</div>
<div className="px-4">

Decodes the user operation's data from `paymasterAndData`.

</div>
</div>
